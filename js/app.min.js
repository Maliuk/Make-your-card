'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var ImageItem = function () {
    function ImageItem(url) {
        var textW = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100;
        var textH = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 100;
        var top = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
        var left = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
        var rotate = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
        var text = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : "";

        _classCallCheck(this, ImageItem);

        this.url = url;
        this.text = text;
        this.textW = textW;
        this.textH = textH;
        this.top = top;
        this.left = left;
        this.rotate = rotate;
    }

    _createClass(ImageItem, [{
        key: 'appendToDomElement',
        value: function appendToDomElement() {
            var html = '<div class="pr-body">' + '<img id="pr-image" src="' + this.url + '" />' + '<div id="pr-text">' + this.text + '</div>' + '</div>';
            $('#preview').html(html);

            $('#pr-text').css({
                'width': this.textW,
                'height': this.textH,
                'top': this.top,
                'left': this.left,
                '-webkit-transform': 'rotate(' + this.rotate + ')',
                '-moz-transform': 'rotate(' + this.rotate + ')',
                '-ms-transform': 'rotate(' + this.rotate + ')',
                '-o-transform': 'rotate(' + this.rotate + ')',
                'transform': 'rotate(' + this.rotate + ')'
            });
            $('#mini-image img, #mini-result img').attr('src', this.url);
        }
    }, {
        key: 'setText',
        value: function setText() {
            var text = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";

            this.text = text;
            $('#pr-text').html(this.text);
        }
    }, {
        key: 'getText',
        value: function getText() {
            return this.text;
        }
    }, {
        key: 'saveImage',
        value: function saveImage() {
            var link = void 0;
            if (!$('a').is('#download')) {
                link = document.createElement('a');
                link.innerHTML = 'download image';
                link.id = 'download';
                link.download = "noname.png";
                document.body.appendChild(link);
            } else {
                link = $('a#download').get(0);
            }

            if (!$("div").is("#preview")) return;
            html2canvas($("#preview"), {
                onrendered: function onrendered(canvas) {
                    //document.body.appendChild(canvas);
                    //link.href = canvas.toDataURL();
                    $(link).attr('href', canvas.toDataURL());
                    link.click();
                }
            });
        }
    }, {
        key: 'shareFB',
        value: function shareFB() {
            html2canvas($("#preview"), {
                onrendered: function onrendered(canvas) {
                    var data = canvas.toDataURL('image/png');
                    try {
                        var blob = dataURItoBlob(data);
                    } catch (e) {
                        console.log(e);
                    }
                    FB.getLoginStatus(function (response) {
                        console.log(response);
                        if (response.status === "connected") {
                            postImageToFacebook(response.authResponse.accessToken, "Canvas to Facebook", "image/png", blob, "http://bit.ly/1QK0Qbsz");
                        } else if (response.status === "not_authorized") {
                            FB.login(function (response) {
                                postImageToFacebook(response.authResponse.accessToken, "Canvas to Facebook", "image/png", blob, "http://bit.ly/1QK0Qbsz");
                            }, { scope: "publish_actions" });
                        } else {
                            FB.login(function (response) {
                                postImageToFacebook(response.authResponse.accessToken, "Canvas to Facebook", "image/png", blob, "http://bit.ly/1QK0Qbsz");
                            }, { scope: "publish_actions" });
                        }
                    });
                }
            });
        }
    }]);

    return ImageItem;
}();

function postImageToFacebook(token, filename, mimeType, imageData, message) {
    var fd = new FormData();
    fd.append("access_token", token);
    fd.append("source", imageData);
    fd.append("no_story", true);

    $('.preloader').removeClass('disable');

    // Upload image to facebook without story(post to feed)
    $.ajax({
        url: "https://graph.facebook.com/me/photos?access_token=" + token,
        type: "POST",
        data: fd,
        processData: false,
        contentType: false,
        cache: false,
        success: function success(data) {
            console.log("success: ", data);
            // Get image source url
            FB.api("/" + data.id + "?fields=images", function (response) {
                if (response && !response.error) {
                    //console.log(response.images[0].source);
                    // Create facebook post using image
                    FB.api("/me/feed", "POST", {
                        "message": "",
                        "picture": response.images[0].source,
                        "link": response.images[0].source,
                        "name": 'Try to do the same',
                        "description": message,
                        "privacy": {
                            value: 'SELF'
                        }
                    }, function (response) {
                        if (response && !response.error) {
                            /* handle the result */
                            console.log("Posted story to facebook");
                            console.log(response);
                            $('.preloader').addClass('disable');

                            $('.pr-modal .pr-body').html('<h2 class="text-center">Shared on facebook</h2>');
                            $('.pr-modal').addClass('shown');
                        }
                    });
                }
            });
        },
        error: function error(shr, status, data) {
            console.log("error " + data + " Status " + shr.status);
        },
        complete: function complete(data) {
            console.log('Post to facebook Complete');
        }
    });
}

function dataURItoBlob(dataURI) {
    // convert base64/URLEncoded data component to raw binary data held in a string
    var byteString;
    if (dataURI.split(',')[0].indexOf('base64') >= 0) byteString = atob(dataURI.split(',')[1]);else byteString = unescape(dataURI.split(',')[1]);

    // separate out the mime component
    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

    // write the bytes of the string to a typed array
    var ia = new Uint8Array(byteString.length);
    for (var i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
    }

    return new Blob([ia], { type: mimeString });
}

var Main = function () {
    function Main() {
        _classCallCheck(this, Main);

        this.image;

        this.windowLoad();
        this.editPageEvents();
        this.saveImage();
        this.shareImage();
    }

    _createClass(Main, [{
        key: 'windowLoad',
        value: function windowLoad() {
            $('.items .item-image').each(function () {
                var imgSrc = $('img', this).attr('src');
                if (imgSrc) {
                    $(this).css('background-image', 'url("' + imgSrc + '")');
                    $('img', this).remove();
                }
            });

            $(window).load(function () {
                $(".scrollbar").mCustomScrollbar({
                    axis: "xy",
                    theme: "inset-2-dark"
                });

                $('.preloader').addClass('disable');
            });

            $('.items .item-frame').click(function (e) {
                e.preventDefault();

                var image = {
                    url: $(this).data('url'),
                    textWidth: $(this).data('text-width'),
                    textHeight: $(this).data('text-height'),
                    top: $(this).data('top'),
                    left: $(this).data('left'),
                    rotate: $(this).data('rotate')
                };

                try {
                    sessionStorage.setItem('image', JSON.stringify(image));
                    window.location = "/edit.html";
                } catch (ex) {
                    console.log(ex);
                }
            });
        }
    }, {
        key: 'editPageEvents',
        value: function editPageEvents() {
            var timeOutId = null;

            var previewUpdate = function previewUpdate() {
                if (timeOutId) clearTimeout(timeOutId);

                timeOutId = setTimeout(function () {
                    html2canvas($("#preview"), {
                        onrendered: function onrendered(canvas) {
                            //document.body.appendChild(canvas);
                            $('#mini-result .item-image').html(canvas);
                        }
                    });
                }, 1000);
            };

            if (window.location.toString().indexOf('edit.html') > -1 && !sessionStorage.getItem('image')) {
                window.location = "/";
            }

            if ($("div").is("#preview") && sessionStorage.getItem('image')) {
                var image = JSON.parse(sessionStorage.getItem('image'));
                var imgObj = new ImageItem(image.url, image.textWidth, image.textHeight, image.top, image.left, image.rotate);
                this.image = imgObj;
                imgObj.appendToDomElement();

                $('#input-text').on("keyup", function () {
                    $('#mini-text .item-image').html($(this).html());
                    imgObj.setText($(this).html());

                    previewUpdate();
                });

                $('#input-text').keydown(function (e) {
                    // trap the return key being pressed
                    if (e.keyCode === 13) {
                        // insert 2 br tags (if only one br tag is inserted the cursor won't go to the next line)
                        document.execCommand('insertHTML', false, '<br><br>');
                        // prevent the default behaviour of return key pressed
                        return false;
                    }
                });

                $('#input-text, #pr-text, #mini-text').css('font-family', $('#select-font').val());
                $('#select-font').on("change", function () {
                    $('#input-text, #pr-text, #mini-text').css('font-family', $(this).val());
                    previewUpdate();
                });

                $('#font-size').on("change", function () {
                    $('#input-text, #pr-text').css('font-size', $(this).val() + 'px');
                    previewUpdate();
                });

                var picker = new CP(document.querySelector('input#font-color'));
                picker.on("change", function (color) {
                    this.target.value = '#' + color;
                    $('#input-text, #pr-text, #mini-text').css('color', '#' + color);
                    previewUpdate();
                });

                $('#mini-result').click(function () {
                    html2canvas($("#preview"), {
                        onrendered: function onrendered(canvas) {
                            //document.body.appendChild(canvas);
                            $('.pr-modal .pr-body').html(canvas);
                            $('.pr-modal').addClass('shown');
                        }
                    });
                });

                $('.pr-modal').click(function () {
                    $(this).removeClass('shown');
                });
            }
        }
    }, {
        key: 'saveImage',
        value: function saveImage() {
            var _this = this;
            if (this.image) {
                $('#btn-download').on("click", function (e) {
                    e.preventDefault();
                    _this.image.saveImage();
                });
            }
        }
    }, {
        key: 'shareImage',
        value: function shareImage() {
            var _this = this;
            if (this.image) {
                $('#btn-poster').on("click", function (e) {
                    e.preventDefault();
                    _this.image.shareFB();
                });
            }
        }
    }]);

    return Main;
}();

$.noConflict();
window.$ = jQuery;
jQuery(document).ready(function ($) {
    new Main();

    window.fbAsyncInit = function () {
        FB.init({
            appId: '1328361773895736',
            status: true,
            cookie: true,
            xfbml: true,
            channelUrl: '//demo.yoursites.online',
            version: 'v2.8'
        });
    };

    (function (d, s, id) {
        var js,
            fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {
            return;
        }
        js = d.createElement(s);js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    })(document, 'script', 'facebook-jssdk');
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImltYWdlLmpzIiwibWFpbi5qcyIsImFwcC5qcyJdLCJuYW1lcyI6WyJJbWFnZUl0ZW0iLCJ1cmwiLCJ0ZXh0VyIsInRleHRIIiwidG9wIiwibGVmdCIsInJvdGF0ZSIsInRleHQiLCJodG1sIiwiJCIsImNzcyIsImF0dHIiLCJsaW5rIiwiaXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJpZCIsImRvd25sb2FkIiwiYm9keSIsImFwcGVuZENoaWxkIiwiZ2V0IiwiaHRtbDJjYW52YXMiLCJvbnJlbmRlcmVkIiwiY2FudmFzIiwidG9EYXRhVVJMIiwiY2xpY2siLCJkYXRhIiwiYmxvYiIsImRhdGFVUkl0b0Jsb2IiLCJlIiwiY29uc29sZSIsImxvZyIsIkZCIiwiZ2V0TG9naW5TdGF0dXMiLCJyZXNwb25zZSIsInN0YXR1cyIsInBvc3RJbWFnZVRvRmFjZWJvb2siLCJhdXRoUmVzcG9uc2UiLCJhY2Nlc3NUb2tlbiIsImxvZ2luIiwic2NvcGUiLCJ0b2tlbiIsImZpbGVuYW1lIiwibWltZVR5cGUiLCJpbWFnZURhdGEiLCJtZXNzYWdlIiwiZmQiLCJGb3JtRGF0YSIsImFwcGVuZCIsInJlbW92ZUNsYXNzIiwiYWpheCIsInR5cGUiLCJwcm9jZXNzRGF0YSIsImNvbnRlbnRUeXBlIiwiY2FjaGUiLCJzdWNjZXNzIiwiYXBpIiwiZXJyb3IiLCJpbWFnZXMiLCJzb3VyY2UiLCJ2YWx1ZSIsImFkZENsYXNzIiwic2hyIiwiY29tcGxldGUiLCJkYXRhVVJJIiwiYnl0ZVN0cmluZyIsInNwbGl0IiwiaW5kZXhPZiIsImF0b2IiLCJ1bmVzY2FwZSIsIm1pbWVTdHJpbmciLCJpYSIsIlVpbnQ4QXJyYXkiLCJsZW5ndGgiLCJpIiwiY2hhckNvZGVBdCIsIkJsb2IiLCJNYWluIiwiaW1hZ2UiLCJ3aW5kb3dMb2FkIiwiZWRpdFBhZ2VFdmVudHMiLCJzYXZlSW1hZ2UiLCJzaGFyZUltYWdlIiwiZWFjaCIsImltZ1NyYyIsInJlbW92ZSIsIndpbmRvdyIsImxvYWQiLCJtQ3VzdG9tU2Nyb2xsYmFyIiwiYXhpcyIsInRoZW1lIiwicHJldmVudERlZmF1bHQiLCJ0ZXh0V2lkdGgiLCJ0ZXh0SGVpZ2h0Iiwic2Vzc2lvblN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImxvY2F0aW9uIiwiZXgiLCJ0aW1lT3V0SWQiLCJwcmV2aWV3VXBkYXRlIiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsInRvU3RyaW5nIiwiZ2V0SXRlbSIsInBhcnNlIiwiaW1nT2JqIiwiYXBwZW5kVG9Eb21FbGVtZW50Iiwib24iLCJzZXRUZXh0Iiwia2V5ZG93biIsImtleUNvZGUiLCJleGVjQ29tbWFuZCIsInZhbCIsInBpY2tlciIsIkNQIiwicXVlcnlTZWxlY3RvciIsImNvbG9yIiwidGFyZ2V0IiwiX3RoaXMiLCJzaGFyZUZCIiwibm9Db25mbGljdCIsImpRdWVyeSIsInJlYWR5IiwiZmJBc3luY0luaXQiLCJpbml0IiwiYXBwSWQiLCJjb29raWUiLCJ4ZmJtbCIsImNoYW5uZWxVcmwiLCJ2ZXJzaW9uIiwiZCIsInMiLCJqcyIsImZqcyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RWxlbWVudEJ5SWQiLCJzcmMiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7SUFBQUEsUztBQUNBLHVCQUFBQyxHQUFBLEVBQUE7QUFBQSxZQUFBQyxLQUFBLHVFQUFBLEdBQUE7QUFBQSxZQUFBQyxLQUFBLHVFQUFBLEdBQUE7QUFBQSxZQUFBQyxHQUFBLHVFQUFBLENBQUE7QUFBQSxZQUFBQyxJQUFBLHVFQUFBLENBQUE7QUFBQSxZQUFBQyxNQUFBLHVFQUFBLENBQUE7QUFBQSxZQUFBQyxJQUFBLHVFQUFBLEVBQUE7O0FBQUE7O0FBQ0EsYUFBQU4sR0FBQSxHQUFBQSxHQUFBO0FBQ0EsYUFBQU0sSUFBQSxHQUFBQSxJQUFBO0FBQ0EsYUFBQUwsS0FBQSxHQUFBQSxLQUFBO0FBQ0EsYUFBQUMsS0FBQSxHQUFBQSxL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SyxjQUFBLENBQUF6SCxFQUFBLENBQUEsRUFBQTtBQUFBO0FBQUE7QUFDQXNILGFBQUFGLEVBQUF0SCxhQUFBLENBQUF1SCxDQUFBLENBQUEsQ0FBQUMsR0FBQXRILEVBQUEsR0FBQUEsRUFBQTtBQUNBc0gsV0FBQUksR0FBQSxHQUFBLHFDQUFBO0FBQ0FILFlBQUFJLFVBQUEsQ0FBQUMsWUFBQSxDQUFBTixFQUFBLEVBQUFDLEdBQUE7QUFDQSxLQU5BLEVBTUExSCxRQU5BLEVBTUEsUUFOQSxFQU1BLGdCQU5BLENBQUE7QUFPQSxDQXJCQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgSW1hZ2VJdGVtIHtcclxuICAgIGNvbnN0cnVjdG9yKHVybCwgdGV4dFcgPSAxMDAsIHRleHRIID0gMTAwLCB0b3AgPSAwLCBsZWZ0ID0gMCwgcm90YXRlID0gMCwgdGV4dCA9IFwiXCIpIHtcclxuICAgICAgICB0aGlzLnVybCA9IHVybDtcclxuICAgICAgICB0aGlzLnRleHQgPSB0ZXh0O1xyXG4gICAgICAgIHRoaXMudGV4dFcgPSB0ZXh0VztcclxuICAgICAgICB0aGlzLnRleHRIID0gdGV4dEg7XHJcbiAgICAgICAgdGhpcy50b3AgPSB0b3A7XHJcbiAgICAgICAgdGhpcy5sZWZ0ID0gbGVmdDtcclxuICAgICAgICB0aGlzLnJvdGF0ZSA9IHJvdGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBhcHBlbmRUb0RvbUVsZW1lbnQoKSB7XHJcbiAgICAgICAgbGV0IGh0bWwgPSAnPGRpdiBjbGFzcz1cInByLWJvZHlcIj4nICtcclxuICAgICAgICAgICAgJzxpbWcgaWQ9XCJwci1pbWFnZVwiIHNyYz1cIicgKyB0aGlzLnVybCArICdcIiAvPicgK1xyXG4gICAgICAgICAgICAnPGRpdiBpZD1cInByLXRleHRcIj4nICtcclxuICAgICAgICAgICAgdGhpcy50ZXh0ICtcclxuICAgICAgICAgICAgJzwvZGl2PicgK1xyXG4gICAgICAgICAgICAnPC9kaXY+JztcclxuICAgICAgICAkKCcjcHJldmlldycpLmh0bWwoaHRtbCk7XHJcblxyXG4gICAgICAgICQoJyNwci10ZXh0JykuY3NzKHtcclxuICAgICAgICAgICAgJ3dpZHRoJzogdGhpcy50ZXh0VyxcclxuICAgICAgICAgICAgJ2hlaWdodCc6IHRoaXMudGV4dEgsXHJcbiAgICAgICAgICAgICd0b3AnOiB0aGlzLnRvcCxcclxuICAgICAgICAgICAgJ2xlZnQnOiB0aGlzLmxlZnQsXHJcbiAgICAgICAgICAgICctd2Via2l0LXRyYW5zZm9ybSc6ICdyb3RhdGUoJyArIHRoaXMucm90YXRlICsgJyknLFxyXG4gICAgICAgICAgICAnLW1vei10cmFuc2Zvcm0nOiAncm90YXRlKCcgKyB0aGlzLnJvdGF0ZSArICcpJyxcclxuICAgICAgICAgICAgJy1tcy10cmFuc2Zvcm0nOiAncm90YXRlKCcgKyB0aGlzLnJvdGF0ZSArICcpJyxcclxuICAgICAgICAgICAgJy1vLXRyYW5zZm9ybSc6ICdyb3RhdGUoJyArIHRoaXMucm90YXRlICsgJyknLFxyXG4gICAgICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgnICsgdGhpcy5yb3RhdGUgKyAnKSdcclxuICAgICAgICB9KTtcclxuICAgICAgICAkKCcjbWluaS1pbWFnZSBpbWcsICNtaW5pLXJlc3VsdCBpbWcnKS5hdHRyKCdzcmMnLCB0aGlzLnVybCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VGV4dCh0ZXh0ID0gXCJcIikge1xyXG4gICAgICAgIHRoaXMudGV4dCA9IHRleHQ7XHJcbiAgICAgICAgJCgnI3ByLXRleHQnKS5odG1sKHRoaXMudGV4dCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VGV4dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50ZXh0O1xyXG4gICAgfVxyXG5cclxuICAgIHNhdmVJbWFnZSgpIHtcclxuICAgICAgICBsZXQgbGluaztcclxuICAgICAgICBpZiAoISQoJ2EnKS5pcygnI2Rvd25sb2FkJykpIHtcclxuICAgICAgICAgICAgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgICAgbGluay5pbm5lckhUTUwgPSAnZG93bmxvYWQgaW1hZ2UnO1xyXG4gICAgICAgICAgICBsaW5rLmlkID0gJ2Rvd25sb2FkJztcclxuICAgICAgICAgICAgbGluay5kb3dubG9hZCA9IFwibm9uYW1lLnBuZ1wiO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGluayA9ICQoJ2EjZG93bmxvYWQnKS5nZXQoMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoISQoXCJkaXZcIikuaXMoXCIjcHJldmlld1wiKSlcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIGh0bWwyY2FudmFzKCQoXCIjcHJldmlld1wiKSwge1xyXG4gICAgICAgICAgICBvbnJlbmRlcmVkOiBmdW5jdGlvbiAoY2FudmFzKSB7XHJcbiAgICAgICAgICAgICAgICAvL2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTtcclxuICAgICAgICAgICAgICAgIC8vbGluay5ocmVmID0gY2FudmFzLnRvRGF0YVVSTCgpO1xyXG4gICAgICAgICAgICAgICAgJChsaW5rKS5hdHRyKCdocmVmJywgY2FudmFzLnRvRGF0YVVSTCgpKTtcclxuICAgICAgICAgICAgICAgIGxpbmsuY2xpY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNoYXJlRkIoKSB7XHJcbiAgICAgICAgaHRtbDJjYW52YXMoJChcIiNwcmV2aWV3XCIpLCB7XHJcbiAgICAgICAgICAgIG9ucmVuZGVyZWQ6IGZ1bmN0aW9uIChjYW52YXMpIHtcclxuICAgICAgICAgICAgICAgIGxldCBkYXRhID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gZGF0YVVSSXRvQmxvYihkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIEZCLmdldExvZ2luU3RhdHVzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSBcImNvbm5lY3RlZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RJbWFnZVRvRmFjZWJvb2socmVzcG9uc2UuYXV0aFJlc3BvbnNlLmFjY2Vzc1Rva2VuLCBcIkNhbnZhcyB0byBGYWNlYm9va1wiLCBcImltYWdlL3BuZ1wiLCBibG9iLCBcImh0dHA6Ly9iaXQubHkvMVFLMFFic3pcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IFwibm90X2F1dGhvcml6ZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBGQi5sb2dpbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RJbWFnZVRvRmFjZWJvb2socmVzcG9uc2UuYXV0aFJlc3BvbnNlLmFjY2Vzc1Rva2VuLCBcIkNhbnZhcyB0byBGYWNlYm9va1wiLCBcImltYWdlL3BuZ1wiLCBibG9iLCBcImh0dHA6Ly9iaXQubHkvMVFLMFFic3pcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtzY29wZTogXCJwdWJsaXNoX2FjdGlvbnNcIn0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEZCLmxvZ2luKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdEltYWdlVG9GYWNlYm9vayhyZXNwb25zZS5hdXRoUmVzcG9uc2UuYWNjZXNzVG9rZW4sIFwiQ2FudmFzIHRvIEZhY2Vib29rXCIsIFwiaW1hZ2UvcG5nXCIsIGJsb2IsIFwiaHR0cDovL2JpdC5seS8xUUswUWJzelwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwge3Njb3BlOiBcInB1Ymxpc2hfYWN0aW9uc1wifSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcG9zdEltYWdlVG9GYWNlYm9vayh0b2tlbiwgZmlsZW5hbWUsIG1pbWVUeXBlLCBpbWFnZURhdGEsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgZmQuYXBwZW5kKFwiYWNjZXNzX3Rva2VuXCIsIHRva2VuKTtcclxuICAgIGZkLmFwcGVuZChcInNvdXJjZVwiLCBpbWFnZURhdGEpO1xyXG4gICAgZmQuYXBwZW5kKFwibm9fc3RvcnlcIiwgdHJ1ZSk7XHJcblxyXG4gICAgJCgnLnByZWxvYWRlcicpLnJlbW92ZUNsYXNzKCdkaXNhYmxlJyk7XHJcbiAgICBcclxuICAgIC8vIFVwbG9hZCBpbWFnZSB0byBmYWNlYm9vayB3aXRob3V0IHN0b3J5KHBvc3QgdG8gZmVlZClcclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiBcImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL3Bob3Rvcz9hY2Nlc3NfdG9rZW49XCIgKyB0b2tlbixcclxuICAgICAgICB0eXBlOiBcIlBPU1RcIixcclxuICAgICAgICBkYXRhOiBmZCxcclxuICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXHJcbiAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxyXG4gICAgICAgIGNhY2hlOiBmYWxzZSxcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInN1Y2Nlc3M6IFwiLCBkYXRhKTtcclxuICAgICAgICAgICAgLy8gR2V0IGltYWdlIHNvdXJjZSB1cmxcclxuICAgICAgICAgICAgRkIuYXBpKFxyXG4gICAgICAgICAgICAgICAgXCIvXCIgKyBkYXRhLmlkICsgXCI/ZmllbGRzPWltYWdlc1wiLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmICFyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLmltYWdlc1swXS5zb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgZmFjZWJvb2sgcG9zdCB1c2luZyBpbWFnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBGQi5hcGkoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi9tZS9mZWVkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1lc3NhZ2VcIjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBpY3R1cmVcIjogcmVzcG9uc2UuaW1hZ2VzWzBdLnNvdXJjZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxpbmtcIjogIHJlc3BvbnNlLmltYWdlc1swXS5zb3VyY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6ICdUcnkgdG8gZG8gdGhlIHNhbWUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjogbWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByaXZhY3lcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ1NFTEYnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiAhcmVzcG9uc2UuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogaGFuZGxlIHRoZSByZXN1bHQgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJQb3N0ZWQgc3RvcnkgdG8gZmFjZWJvb2tcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnByZWxvYWRlcicpLmFkZENsYXNzKCdkaXNhYmxlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcucHItbW9kYWwgLnByLWJvZHknKS5odG1sKCc8aDIgY2xhc3M9XCJ0ZXh0LWNlbnRlclwiPlNoYXJlZCBvbiBmYWNlYm9vazwvaDI+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5wci1tb2RhbCcpLmFkZENsYXNzKCdzaG93bicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHNociwgc3RhdHVzLCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgXCIgKyBkYXRhICsgXCIgU3RhdHVzIFwiICsgc2hyLnN0YXR1cyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1Bvc3QgdG8gZmFjZWJvb2sgQ29tcGxldGUnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZGF0YVVSSXRvQmxvYihkYXRhVVJJKSB7XHJcbiAgICAvLyBjb252ZXJ0IGJhc2U2NC9VUkxFbmNvZGVkIGRhdGEgY29tcG9uZW50IHRvIHJhdyBiaW5hcnkgZGF0YSBoZWxkIGluIGEgc3RyaW5nXHJcbiAgICB2YXIgYnl0ZVN0cmluZztcclxuICAgIGlmIChkYXRhVVJJLnNwbGl0KCcsJylbMF0uaW5kZXhPZignYmFzZTY0JykgPj0gMClcclxuICAgICAgICBieXRlU3RyaW5nID0gYXRvYihkYXRhVVJJLnNwbGl0KCcsJylbMV0pO1xyXG4gICAgZWxzZVxyXG4gICAgICAgIGJ5dGVTdHJpbmcgPSB1bmVzY2FwZShkYXRhVVJJLnNwbGl0KCcsJylbMV0pO1xyXG5cclxuICAgIC8vIHNlcGFyYXRlIG91dCB0aGUgbWltZSBjb21wb25lbnRcclxuICAgIHZhciBtaW1lU3RyaW5nID0gZGF0YVVSSS5zcGxpdCgnLCcpWzBdLnNwbGl0KCc6JylbMV0uc3BsaXQoJzsnKVswXTtcclxuXHJcbiAgICAvLyB3cml0ZSB0aGUgYnl0ZXMgb2YgdGhlIHN0cmluZyB0byBhIHR5cGVkIGFycmF5XHJcbiAgICB2YXIgaWEgPSBuZXcgVWludDhBcnJheShieXRlU3RyaW5nLmxlbmd0aCk7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5dGVTdHJpbmcubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpYVtpXSA9IGJ5dGVTdHJpbmcuY2hhckNvZGVBdChpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3IEJsb2IoW2lhXSwge3R5cGU6bWltZVN0cmluZ30pO1xyXG59IiwiY2xhc3MgTWFpbiB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmltYWdlO1xyXG5cclxuICAgICAgICB0aGlzLndpbmRvd0xvYWQoKTtcclxuICAgICAgICB0aGlzLmVkaXRQYWdlRXZlbnRzKCk7XHJcbiAgICAgICAgdGhpcy5zYXZlSW1hZ2UoKTtcclxuICAgICAgICB0aGlzLnNoYXJlSW1hZ2UoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgd2luZG93TG9hZCgpIHtcclxuICAgICAgICAkKCcuaXRlbXMgLml0ZW0taW1hZ2UnKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGltZ1NyYyA9ICQoJ2ltZycsIHRoaXMpLmF0dHIoJ3NyYycpO1xyXG4gICAgICAgICAgICBpZiAoaW1nU3JjKSB7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcygnYmFja2dyb3VuZC1pbWFnZScsICd1cmwoXCInICsgaW1nU3JjICsgJ1wiKScpO1xyXG4gICAgICAgICAgICAgICAgJCgnaW1nJywgdGhpcykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCh3aW5kb3cpLmxvYWQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKFwiLnNjcm9sbGJhclwiKS5tQ3VzdG9tU2Nyb2xsYmFyKHtcclxuICAgICAgICAgICAgICAgIGF4aXM6XCJ4eVwiLFxyXG4gICAgICAgICAgICAgICAgdGhlbWU6IFwiaW5zZXQtMi1kYXJrXCJcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcucHJlbG9hZGVyJykuYWRkQ2xhc3MoJ2Rpc2FibGUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCgnLml0ZW1zIC5pdGVtLWZyYW1lJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGltYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAkKHRoaXMpLmRhdGEoJ3VybCcpLFxyXG4gICAgICAgICAgICAgICAgdGV4dFdpZHRoOiAkKHRoaXMpLmRhdGEoJ3RleHQtd2lkdGgnKSxcclxuICAgICAgICAgICAgICAgIHRleHRIZWlnaHQ6ICQodGhpcykuZGF0YSgndGV4dC1oZWlnaHQnKSxcclxuICAgICAgICAgICAgICAgIHRvcDogJCh0aGlzKS5kYXRhKCd0b3AnKSxcclxuICAgICAgICAgICAgICAgIGxlZnQ6ICQodGhpcykuZGF0YSgnbGVmdCcpLFxyXG4gICAgICAgICAgICAgICAgcm90YXRlOiAkKHRoaXMpLmRhdGEoJ3JvdGF0ZScpXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnaW1hZ2UnLCBKU09OLnN0cmluZ2lmeShpbWFnZSkpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gXCIvZWRpdC5odG1sXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0UGFnZUV2ZW50cygpIHtcclxuICAgICAgICBsZXQgdGltZU91dElkID0gbnVsbDtcclxuXHJcbiAgICAgICAgbGV0IHByZXZpZXdVcGRhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aW1lT3V0SWQpXHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZU91dElkKTtcclxuXHJcbiAgICAgICAgICAgIHRpbWVPdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaHRtbDJjYW52YXMoJChcIiNwcmV2aWV3XCIpLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25yZW5kZXJlZDogZnVuY3Rpb24oY2FudmFzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbWluaS1yZXN1bHQgLml0ZW0taW1hZ2UnKS5odG1sKGNhbnZhcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi50b1N0cmluZygpLmluZGV4T2YoJ2VkaXQuaHRtbCcpID4gLTEgJiYgIXNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2ltYWdlJykpIHtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gXCIvXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJChcImRpdlwiKS5pcyhcIiNwcmV2aWV3XCIpICYmIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2ltYWdlJykpIHtcclxuICAgICAgICAgICAgdmFyIGltYWdlID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdpbWFnZScpKTtcclxuICAgICAgICAgICAgdmFyIGltZ09iaiA9IG5ldyBJbWFnZUl0ZW0oaW1hZ2UudXJsLCBpbWFnZS50ZXh0V2lkdGgsIGltYWdlLnRleHRIZWlnaHQsIGltYWdlLnRvcCwgaW1hZ2UubGVmdCwgaW1hZ2Uucm90YXRlKTtcclxuICAgICAgICAgICAgdGhpcy5pbWFnZSA9IGltZ09iajtcclxuICAgICAgICAgICAgaW1nT2JqLmFwcGVuZFRvRG9tRWxlbWVudCgpO1xyXG5cclxuICAgICAgICAgICAgJCgnI2lucHV0LXRleHQnKS5vbihcImtleXVwXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoJyNtaW5pLXRleHQgLml0ZW0taW1hZ2UnKS5odG1sKCQodGhpcykuaHRtbCgpKTtcclxuICAgICAgICAgICAgICAgIGltZ09iai5zZXRUZXh0KCQodGhpcykuaHRtbCgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3VXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnI2lucHV0LXRleHQnKS5rZXlkb3duKGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRyYXAgdGhlIHJldHVybiBrZXkgYmVpbmcgcHJlc3NlZFxyXG4gICAgICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpbnNlcnQgMiBiciB0YWdzIChpZiBvbmx5IG9uZSBiciB0YWcgaXMgaW5zZXJ0ZWQgdGhlIGN1cnNvciB3b24ndCBnbyB0byB0aGUgbmV4dCBsaW5lKVxyXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRIVE1MJywgZmFsc2UsICc8YnI+PGJyPicpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgdGhlIGRlZmF1bHQgYmVoYXZpb3VyIG9mIHJldHVybiBrZXkgcHJlc3NlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcjaW5wdXQtdGV4dCwgI3ByLXRleHQsICNtaW5pLXRleHQnKS5jc3MoJ2ZvbnQtZmFtaWx5JywgJCgnI3NlbGVjdC1mb250JykudmFsKCkpO1xyXG4gICAgICAgICAgICAkKCcjc2VsZWN0LWZvbnQnKS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkKCcjaW5wdXQtdGV4dCwgI3ByLXRleHQsICNtaW5pLXRleHQnKS5jc3MoJ2ZvbnQtZmFtaWx5JywgJCh0aGlzKS52YWwoKSk7XHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3VXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnI2ZvbnQtc2l6ZScpLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoJyNpbnB1dC10ZXh0LCAjcHItdGV4dCcpLmNzcygnZm9udC1zaXplJywgJCh0aGlzKS52YWwoKSArICdweCcpO1xyXG4gICAgICAgICAgICAgICAgcHJldmlld1VwZGF0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBwaWNrZXIgPSBuZXcgQ1AoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQjZm9udC1jb2xvcicpKTtcclxuICAgICAgICAgICAgcGlja2VyLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKGNvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldC52YWx1ZSA9ICcjJyArIGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgJCgnI2lucHV0LXRleHQsICNwci10ZXh0LCAjbWluaS10ZXh0JykuY3NzKCdjb2xvcicsICcjJyArIGNvbG9yKTtcclxuICAgICAgICAgICAgICAgIHByZXZpZXdVcGRhdGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcjbWluaS1yZXN1bHQnKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBodG1sMmNhbnZhcygkKFwiI3ByZXZpZXdcIiksIHtcclxuICAgICAgICAgICAgICAgICAgICBvbnJlbmRlcmVkOiBmdW5jdGlvbihjYW52YXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5wci1tb2RhbCAucHItYm9keScpLmh0bWwoY2FudmFzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnByLW1vZGFsJykuYWRkQ2xhc3MoJ3Nob3duJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnLnByLW1vZGFsJykuY2xpY2soZnVuY3Rpb24gKCl7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdzaG93bicpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZUltYWdlKCkge1xyXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoaXMuaW1hZ2UpIHtcclxuICAgICAgICAgICAgJCgnI2J0bi1kb3dubG9hZCcpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmltYWdlLnNhdmVJbWFnZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2hhcmVJbWFnZSgpIHtcclxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLmltYWdlKSB7XHJcbiAgICAgICAgICAgICQoJyNidG4tcG9zdGVyJykub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuaW1hZ2Uuc2hhcmVGQigpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59IiwiJC5ub0NvbmZsaWN0KCk7XHJcbndpbmRvdy4kID0galF1ZXJ5O1xyXG5qUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgkKSB7XHJcbiAgICBuZXcgTWFpbigpO1xyXG5cclxuICAgIHdpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIEZCLmluaXQoe1xyXG4gICAgICAgICAgICBhcHBJZCAgICAgIDogJzEzMjgzNjE3NzM4OTU3MzYnLFxyXG4gICAgICAgICAgICBzdGF0dXM6IHRydWUsXHJcbiAgICAgICAgICAgIGNvb2tpZTogdHJ1ZSxcclxuICAgICAgICAgICAgeGZibWw6IHRydWUsXHJcbiAgICAgICAgICAgIGNoYW5uZWxVcmwgOiAnLy9kZW1vLnlvdXJzaXRlcy5vbmxpbmUnLFxyXG4gICAgICAgICAgICB2ZXJzaW9uICAgIDogJ3YyLjgnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIChmdW5jdGlvbihkLCBzLCBpZCl7XHJcbiAgICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xyXG4gICAgICAgIGlmIChkLmdldEVsZW1lbnRCeUlkKGlkKSkge3JldHVybjt9XHJcbiAgICAgICAganMgPSBkLmNyZWF0ZUVsZW1lbnQocyk7IGpzLmlkID0gaWQ7XHJcbiAgICAgICAganMuc3JjID0gXCIvL2Nvbm5lY3QuZmFjZWJvb2submV0L2VuX1VTL3Nkay5qc1wiO1xyXG4gICAgICAgIGZqcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgZmpzKTtcclxuICAgIH0oZG9jdW1lbnQsICdzY3JpcHQnLCAnZmFjZWJvb2stanNzZGsnKSk7XHJcbn0pOyJdfQ==
