"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function postImageToFacebook(t,e,o,n,a){var i=new FormData;i.append("access_token",t),i.append("source",n),i.append("no_story",!0),$(".preloader").removeClass("disable"),$.ajax({url:"https://graph.facebook.com/me/photos?access_token="+t,type:"POST",data:i,processData:!1,contentType:!1,cache:!1,success:function(t){console.log("success: ",t),FB.api("/"+t.id+"?fields=images",function(t){t&&!t.error&&FB.api("/me/feed","POST",{message:"",picture:t.images[0].source,link:t.images[0].source,name:"Try to do the same",description:a,privacy:{value:"SELF"}},function(t){t&&!t.error&&(console.log("Posted story to facebook"),console.log(t),$(".preloader").addClass("disable"),$(".pr-modal .pr-body").html('<h2 class="text-center">Shared on facebook</h2>'),$(".pr-modal").addClass("shown"))})})},error:function(t,e,o){console.log("error "+o+" Status "+t.status)},complete:function(t){console.log("Post to facebook Complete")}})}function dataURItoBlob(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var o=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),a=0;a<e.length;a++)n[a]=e.charCodeAt(a);return new Blob([n],{type:o})}var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),ImageItem=function(){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";_classCallCheck(this,t),this.url=e,this.text=r,this.textW=o,this.textH=n,this.top=a,this.left=i,this.rotate=s}return _createClass(t,[{key:"appendToDomElement",value:function(){var t='<div class="pr-body"><img id="pr-image" src="'+this.url+'" /><div id="pr-text">'+this.text+"</div></div>";$("#preview").html(t),$("#pr-text").css({width:this.textW,height:this.textH,top:this.top,left:this.left,"-webkit-transform":"rotate("+this.rotate+")","-moz-transform":"rotate("+this.rotate+")","-ms-transform":"rotate("+this.rotate+")","-o-transform":"rotate("+this.rotate+")",transform:"rotate("+this.rotate+")"}),$("#mini-image img, #mini-result img").attr("src",this.url)}},{key:"setText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.text=t,$("#pr-text").html(this.text)}},{key:"getText",value:function(){return this.text}},{key:"saveImage",value:function(){var t=void 0;$("a").is("#download")?t=$("a#download").get(0):(t=document.createElement("a"),t.innerHTML="download image",t.id="download",t.download="noname.png",document.body.appendChild(t)),$("div").is("#preview")&&html2canvas($("#preview"),{onrendered:function(e){$(t).attr("href",e.toDataURL()),t.click()}})}},{key:"shareFB",value:function(){html2canvas($("#preview"),{onrendered:function(t){var e=t.toDataURL("image/png");try{var o=dataURItoBlob(e)}catch(t){console.log(t)}FB.getLoginStatus(function(t){console.log(t),"connected"===t.status?postImageToFacebook(t.authResponse.accessToken,"Canvas to Facebook","image/png",o,"http://bit.ly/1QK0Qbsz"):(t.status,FB.login(function(t){postImageToFacebook(t.authResponse.accessToken,"Canvas to Facebook","image/png",o,"http://bit.ly/1QK0Qbsz")},{scope:"publish_actions"}))})}})}}]),t}(),Main=function(){function t(){_classCallCheck(this,t),this.image,this.windowLoad(),this.editPageEvents(),this.saveImage(),this.shareImage()}return _createClass(t,[{key:"windowLoad",value:function(){$(".items .item-image").each(function(){var t=$("img",this).attr("src");t&&($(this).css("background-image",'url("'+t+'")'),$("img",this).remove())}),$(window).load(function(){$(".scrollbar").mCustomScrollbar({axis:"xy",theme:"inset-2-dark"}),$(".preloader").addClass("disable")}),$(".items .item-frame").click(function(t){t.preventDefault();var e={url:$(this).data("url"),textWidth:$(this).data("text-width"),textHeight:$(this).data("text-height"),top:$(this).data("top"),left:$(this).data("left"),rotate:$(this).data("rotate")};try{sessionStorage.setItem("image",JSON.stringify(e)),window.location="/edit.html"}catch(t){console.log(t)}})}},{key:"editPageEvents",value:function(){var t=null,e=function(){t&&clearTimeout(t),t=setTimeout(function(){html2canvas($("#preview"),{onrendered:function(t){$("#mini-result .item-image").html(t)}})},1e3)};if(window.location.toString().indexOf("edit.html")>-1&&!sessionStorage.getItem("image")&&(window.location="/"),$("div").is("#preview")&&sessionStorage.getItem("image")){var o=JSON.parse(sessionStorage.getItem("image")),n=new ImageItem(o.url,o.textWidth,o.textHeight,o.top,o.left,o.rotate);this.image=n,n.appendToDomElement(),$("#input-text").on("keyup",function(){$("#mini-text .item-image").html($(this).html()),n.setText($(this).html()),e()}),$("#input-text").keydown(function(t){if(13===t.keyCode)return document.execCommand("insertHTML",!1,"<br><br>"),!1}),$("#input-text, #pr-text, #mini-text").css("font-family",$("#select-font").val()),$("#select-font").on("change",function(){$("#input-text, #pr-text, #mini-text").css("font-family",$(this).val()),e()}),$("#font-size").on("change",function(){$("#input-text, #pr-text").css("font-size",$(this).val()+"px"),e()});new CP(document.querySelector("input#font-color")).on("change",function(t){this.target.value="#"+t,$("#input-text, #pr-text, #mini-text").css("color","#"+t),e()}),$("#mini-result").click(function(){html2canvas($("#preview"),{onrendered:function(t){$(".pr-modal .pr-body").html(t),$(".pr-modal").addClass("shown")}})}),$(".pr-modal").click(function(){$(this).removeClass("shown")})}}},{key:"saveImage",value:function(){var t=this;this.image&&$("#btn-download").on("click",function(e){e.preventDefault(),t.image.saveImage()})}},{key:"shareImage",value:function(){var t=this;this.image&&$("#btn-poster").on("click",function(e){e.preventDefault(),t.image.shareFB()})}}]),t}();$.noConflict(),window.$=jQuery,jQuery(document).ready(function(t){new Main,window.fbAsyncInit=function(){FB.init({appId:"1328361773895736",status:!0,cookie:!0,xfbml:!0,channelUrl:"//demo.yoursites.online",version:"v2.8"})},function(t,e,o){var n,a=t.getElementsByTagName(e)[0];t.getElementById(o)||(n=t.createElement(e),n.id=o,n.src="//connect.facebook.net/en_US/sdk.js",a.parentNode.insertBefore(n,a))}(document,"script","facebook-jssdk")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImltYWdlLmpzIiwibWFpbi5qcyIsImFwcC5qcyJdLCJuYW1lcyI6WyJwb3N0SW1hZ2VUb0ZhY2Vib29rIiwidG9rZW4iLCJmaWxlbmFtZSIsIm1pbWVUeXBlIiwiaW1hZ2VEYXRhIiwibWVzc2FnZSIsImZkIiwiRm9ybURhdGEiLCJhcHBlbmQiLCIkIiwicmVtb3ZlQ2xhc3MiLCJhamF4IiwidXJsIiwidHlwZSIsImRhdGEiLCJwcm9jZXNzRGF0YSIsImNvbnRlbnRUeXBlIiwiY2FjaGUiLCJzdWNjZXNzIiwiY29uc29sZSIsImxvZyIsIkZCIiwiYXBpIiwiaWQiLCJyZXNwb25zZSIsImVycm9yIiwicGljdHVyZSIsImltYWdlcyIsInNvdXJjZSIsImxpbmsiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJwcml2YWN5IiwidmFsdWUiLCJhZGRDbGFzcyIsImh0bWwiLCJzaHIiLCJzdGF0dXMiLCJjb21wbGV0ZSIsImRhdGFVUkl0b0Jsb2IiLCJkYXRhVVJJIiwiYnl0ZVN0cmluZyIsInNwbGl0IiwiaW5kZXhPZiIsImF0b2IiLCJ1bmVzY2FwZSIsIm1pbWVTdHJpbmciLCJpYSIsIlVpbnQ4QXJyYXkiLCJsZW5ndGgiLCJpIiwiY2hhckNvZGVBdCIsIkJsb2IiLCJJbWFnZUl0ZW0iLCJ0ZXh0VyIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsInRleHRIIiwidG9wIiwibGVmdCIsInJvdGF0ZSIsInRleHQiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiY3NzIiwid2lkdGgiLCJoZWlnaHQiLCItd2Via2l0LXRyYW5zZm9ybSIsIi1tb3otdHJhbnNmb3JtIiwiLW1zLXRyYW5zZm9ybSIsIi1vLXRyYW5zZm9ybSIsInRyYW5zZm9ybSIsImF0dHIiLCJpcyIsImdldCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImRvd25sb2FkIiwiYm9keSIsImFwcGVuZENoaWxkIiwiaHRtbDJjYW52YXMiLCJvbnJlbmRlcmVkIiwiY2FudmFzIiwidG9EYXRhVVJMIiwiY2xpY2siLCJibG9iIiwiZSIsImdldExvZ2luU3RhdHVzIiwiYXV0aFJlc3BvbnNlIiwiYWNjZXNzVG9rZW4iLCJsb2dpbiIsInNjb3BlIiwiTWFpbiIsImltYWdlIiwid2luZG93TG9hZCIsImVkaXRQYWdlRXZlbnRzIiwic2F2ZUltYWdlIiwic2hhcmVJbWFnZSIsImVhY2giLCJpbWdTcmMiLCJyZW1vdmUiLCJ3aW5kb3ciLCJsb2FkIiwibUN1c3RvbVNjcm9sbGJhciIsImF4aXMiLCJ0aGVtZSIsInByZXZlbnREZWZhdWx0IiwidGV4dFdpZHRoIiwidGV4dEhlaWdodCIsInNlc3Npb25TdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJsb2NhdGlvbiIsImV4IiwidGltZU91dElkIiwicHJldmlld1VwZGF0ZSIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJ0b1N0cmluZyIsImdldEl0ZW0iLCJwYXJzZSIsImltZ09iaiIsImFwcGVuZFRvRG9tRWxlbWVudCIsIm9uIiwic2V0VGV4dCIsImtleWRvd24iLCJrZXlDb2RlIiwiZXhlY0NvbW1hbmQiLCJ2YWwiLCJDUCIsInF1ZXJ5U2VsZWN0b3IiLCJjb2xvciIsInRhcmdldCIsIl90aGlzIiwic2hhcmVGQiIsIm5vQ29uZmxpY3QiLCJqUXVlcnkiLCJyZWFkeSIsImZiQXN5bmNJbml0IiwiaW5pdCIsImFwcElkIiwiY29va2llIiwieGZibWwiLCJjaGFubmVsVXJsIiwidmVyc2lvbiIsImQiLCJzIiwianMiLCJmanMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6InlIQWdHQSxRQUFBQSxxQkFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQSxHQUFBQyxHQUFBLEdBQUFDLFNBQ0FELEdBQUFFLE9BQUEsZUFBQVAsR0FDQUssRUFBQUUsT0FBQSxTQUFBSixHQUNBRSxFQUFBRSxPQUFBLFlBQUEsR0FFQUMsRUFBQSxjQUFBQyxZQUFBLFdBR0FELEVBQUFFLE1BQ0FDLElBQUEscURBQUFYLEVBQ0FZLEtBQUEsT0FDQUMsS0FBQVIsRUFDQVMsYUFBQSxFQUNBQyxhQUFBLEVBQ0FDLE9BQUEsRUFDQUMsUUFBQSxTQUFBSixHQUNBSyxRQUFBQyxJQUFBLFlBQUFOLEdBRUFPLEdBQUFDLElBQ0EsSUFBQVIsRUFBQVMsR0FBQSxpQkFDQSxTQUFBQyxHQUNBQSxJQUFBQSxFQUFBQyxPQUdBSixHQUFBQyxJQUNBLFdBQ0EsUUFFQWpCLFFBQUEsR0FDQXFCLFFBQUFGLEVBQUFHLE9BQUEsR0FBQUMsT0FDQUMsS0FBQUwsRUFBQUcsT0FBQSxHQUFBQyxPQUNBRSxLQUFBLHFCQUNBQyxZQUFBMUIsRUFDQTJCLFNBQ0FDLE1BQUEsU0FHQSxTQUFBVCxHQUNBQSxJQUFBQSxFQUFBQyxRQUVBTixRQUFBQyxJQUFBLDRCQUNBRCxRQUFBQyxJQUFBSSxHQUNBZixFQUFBLGNBQUF5QixTQUFBLFdBRUF6QixFQUFBLHNCQUFBMEIsS0FBQSxtREFDQTFCLEVBQUEsYUFBQXlCLFNBQUEsZUFRQVQsTUFBQSxTQUFBVyxFQUFBQyxFQUFBdkIsR0FDQUssUUFBQUMsSUFBQSxTQUFBTixFQUFBLFdBQUFzQixFQUFBQyxTQUVBQyxTQUFBLFNBQUF4QixHQUNBSyxRQUFBQyxJQUFBLGdDQUtBLFFBQUFtQixlQUFBQyxHQUVBLEdBQUFDLEVBRUFBLEdBREFELEVBQUFFLE1BQUEsS0FBQSxHQUFBQyxRQUFBLFdBQUEsRUFDQUMsS0FBQUosRUFBQUUsTUFBQSxLQUFBLElBRUFHLFNBQUFMLEVBQUFFLE1BQUEsS0FBQSxHQU9BLEtBQUEsR0FKQUksR0FBQU4sRUFBQUUsTUFBQSxLQUFBLEdBQUFBLE1BQUEsS0FBQSxHQUFBQSxNQUFBLEtBQUEsR0FHQUssRUFBQSxHQUFBQyxZQUFBUCxFQUFBUSxRQUNBQyxFQUFBLEVBQUFBLEVBQUFULEVBQUFRLE9BQUFDLElBQ0FILEVBQUFHLEdBQUFULEVBQUFVLFdBQUFELEVBR0EsT0FBQSxJQUFBRSxPQUFBTCxJQUFBbEMsS0FBQWlDLHdRQWhMQU8scUJBQ0EsUUFBQUEsR0FBQXpDLEdBQUEsR0FBQTBDLEdBQUFDLFVBQUFOLE9BQUEsR0FBQU8sU0FBQUQsVUFBQSxHQUFBQSxVQUFBLEdBQUEsSUFBQUUsRUFBQUYsVUFBQU4sT0FBQSxHQUFBTyxTQUFBRCxVQUFBLEdBQUFBLFVBQUEsR0FBQSxJQUFBRyxFQUFBSCxVQUFBTixPQUFBLEdBQUFPLFNBQUFELFVBQUEsR0FBQUEsVUFBQSxHQUFBLEVBQUFJLEVBQUFKLFVBQUFOLE9BQUEsR0FBQU8sU0FBQUQsVUFBQSxHQUFBQSxVQUFBLEdBQUEsRUFBQUssRUFBQUwsVUFBQU4sT0FBQSxHQUFBTyxTQUFBRCxVQUFBLEdBQUFBLFVBQUEsR0FBQSxFQUFBTSxFQUFBTixVQUFBTixPQUFBLEdBQUFPLFNBQUFELFVBQUEsR0FBQUEsVUFBQSxHQUFBLEVBQUFPLGlCQUFBQyxLQUFBVixHQUNBVSxLQUFBbkQsSUFBQUEsRUFDQW1ELEtBQUFGLEtBQUFBLEVBQ0FFLEtBQUFULE1BQUFBLEVBQ0FTLEtBQUFOLE1BQUFBLEVBQ0FNLEtBQUFMLElBQUFBLEVBQ0FLLEtBQUFKLEtBQUFBLEVBQ0FJLEtBQUFILE9BQUFBLG9FQUlBLEdBQUF6QixHQUFBLGdEQUNBNEIsS0FBQW5ELElBQUEseUJBRUFtRCxLQUFBRixLQUNBLGNBRUFwRCxHQUFBLFlBQUEwQixLQUFBQSxHQUVBMUIsRUFBQSxZQUFBdUQsS0FDQUMsTUFBQUYsS0FBQVQsTUFDQVksT0FBQUgsS0FBQU4sTUFDQUMsSUFBQUssS0FBQUwsSUFDQUMsS0FBQUksS0FBQUosS0FDQVEsb0JBQUEsVUFBQUosS0FBQUgsT0FBQSxJQUNBUSxpQkFBQSxVQUFBTCxLQUFBSCxPQUFBLElBQ0FTLGdCQUFBLFVBQUFOLEtBQUFILE9BQUEsSUFDQVUsZUFBQSxVQUFBUCxLQUFBSCxPQUFBLElBQ0FXLFVBQUEsVUFBQVIsS0FBQUgsT0FBQSxNQUVBbkQsRUFBQSxxQ0FBQStELEtBQUEsTUFBQVQsS0FBQW5ELHVDQUdBLEdBQUFpRCxHQUFBTixVQUFBTixPQUFBLEdBQUFPLFNBQUFELFVBQUEsR0FBQUEsVUFBQSxHQUFBLEVBQ0FRLE1BQUFGLEtBQUFBLEVBQ0FwRCxFQUFBLFlBQUEwQixLQUFBNEIsS0FBQUYsd0NBSUEsTUFBQUUsTUFBQUYseUNBSUEsR0FBQWhDLEdBQUFBLE1BQ0FwQixHQUFBLEtBQUFnRSxHQUFBLGFBUUE1QyxFQUFBcEIsRUFBQSxjQUFBaUUsSUFBQSxJQVBBN0MsRUFBQThDLFNBQUFDLGNBQUEsS0FDQS9DLEVBQUFnRCxVQUFBLGlCQUNBaEQsRUFBQU4sR0FBQSxXQUNBTSxFQUFBaUQsU0FBQSxhQUNBSCxTQUFBSSxLQUFBQyxZQUFBbkQsSUFNQXBCLEVBQUEsT0FBQWdFLEdBQUEsYUFFQVEsWUFBQXhFLEVBQUEsYUFDQXlFLFdBQUEsU0FBQUMsR0FHQTFFLEVBQUFvQixHQUFBMkMsS0FBQSxPQUFBVyxFQUFBQyxhQUNBdkQsRUFBQXdELDZDQU1BSixZQUFBeEUsRUFBQSxhQUNBeUUsV0FBQSxTQUFBQyxHQUNBLEdBQUFyRSxHQUFBcUUsRUFBQUMsVUFBQSxZQUNBLEtBQ0EsR0FBQUUsR0FBQS9DLGNBQUF6QixHQUNBLE1BQUF5RSxHQUNBcEUsUUFBQUMsSUFBQW1FLEdBRUFsRSxHQUFBbUUsZUFBQSxTQUFBaEUsR0FDQUwsUUFBQUMsSUFBQUksR0FDQSxjQUFBQSxFQUFBYSxPQUNBckMsb0JBQUF3QixFQUFBaUUsYUFBQUMsWUFBQSxxQkFBQSxZQUFBSixFQUFBLDJCQUNBOUQsRUFBQWEsT0FDQWhCLEdBQUFzRSxNQUFBLFNBQUFuRSxHQUNBeEIsb0JBQUF3QixFQUFBaUUsYUFBQUMsWUFBQSxxQkFBQSxZQUFBSixFQUFBLDRCQUNBTSxNQUFBLG1DQ3BGQUMsZ0JBQ0EsUUFBQUEsS0FBQS9CLGdCQUFBQyxLQUFBOEIsR0FDQTlCLEtBQUErQixNQUVBL0IsS0FBQWdDLGFBQ0FoQyxLQUFBaUMsaUJBQ0FqQyxLQUFBa0MsWUFDQWxDLEtBQUFtQyx1RUFLQXpGLEVBQUEsc0JBQUEwRixLQUFBLFdBQ0EsR0FBQUMsR0FBQTNGLEVBQUEsTUFBQXNELE1BQUFTLEtBQUEsTUFDQTRCLEtBQ0EzRixFQUFBc0QsTUFBQUMsSUFBQSxtQkFBQSxRQUFBb0MsRUFBQSxNQUNBM0YsRUFBQSxNQUFBc0QsTUFBQXNDLFlBSUE1RixFQUFBNkYsUUFBQUMsS0FBQSxXQUNBOUYsRUFBQSxjQUFBK0Ysa0JBQ0FDLEtBQUEsS0FDQUMsTUFBQSxpQkFHQWpHLEVBQUEsY0FBQXlCLFNBQUEsYUFHQXpCLEVBQUEsc0JBQUE0RSxNQUFBLFNBQUFFLEdBQ0FBLEVBQUFvQixnQkFFQSxJQUFBYixJQUNBbEYsSUFBQUgsRUFBQXNELE1BQUFqRCxLQUFBLE9BQ0E4RixVQUFBbkcsRUFBQXNELE1BQUFqRCxLQUFBLGNBQ0ErRixXQUFBcEcsRUFBQXNELE1BQUFqRCxLQUFBLGVBQ0E0QyxJQUFBakQsRUFBQXNELE1BQUFqRCxLQUFBLE9BQ0E2QyxLQUFBbEQsRUFBQXNELE1BQUFqRCxLQUFBLFFBQ0E4QyxPQUFBbkQsRUFBQXNELE1BQUFqRCxLQUFBLFVBR0EsS0FDQWdHLGVBQUFDLFFBQUEsUUFBQUMsS0FBQUMsVUFBQW5CLElBQ0FRLE9BQUFZLFNBQUEsYUFFQSxNQUFBQyxHQUNBaEcsUUFBQUMsSUFBQStGLCtDQU1BLEdBQUFDLEdBQUEsS0FFQUMsRUFBQSxXQUNBRCxHQUNBRSxhQUFBRixHQUVBQSxFQUFBRyxXQUFBLFdBQ0F0QyxZQUFBeEUsRUFBQSxhQUNBeUUsV0FBQSxTQUFBQyxHQUVBMUUsRUFBQSw0QkFBQTBCLEtBQUFnRCxPQUdBLEtBT0EsSUFKQW1CLE9BQUFZLFNBQUFNLFdBQUE3RSxRQUFBLGNBQUEsSUFBQW1FLGVBQUFXLFFBQUEsV0FDQW5CLE9BQUFZLFNBQUEsS0FHQXpHLEVBQUEsT0FBQWdFLEdBQUEsYUFBQXFDLGVBQUFXLFFBQUEsU0FBQSxDQUNBLEdBQUEzQixHQUFBa0IsS0FBQVUsTUFBQVosZUFBQVcsUUFBQSxVQUNBRSxFQUFBLEdBQUF0RSxXQUFBeUMsRUFBQWxGLElBQUFrRixFQUFBYyxVQUFBZCxFQUFBZSxXQUFBZixFQUFBcEMsSUFBQW9DLEVBQUFuQyxLQUFBbUMsRUFBQWxDLE9BQ0FHLE1BQUErQixNQUFBNkIsRUFDQUEsRUFBQUMscUJBRUFuSCxFQUFBLGVBQUFvSCxHQUFBLFFBQUEsV0FDQXBILEVBQUEsMEJBQUEwQixLQUFBMUIsRUFBQXNELE1BQUE1QixRQUNBd0YsRUFBQUcsUUFBQXJILEVBQUFzRCxNQUFBNUIsUUFFQWtGLE1BR0E1RyxFQUFBLGVBQUFzSCxRQUFBLFNBQUF4QyxHQUVBLEdBQUEsS0FBQUEsRUFBQXlDLFFBSUEsTUFGQXJELFVBQUFzRCxZQUFBLGNBQUEsRUFBQSxhQUVBLElBSUF4SCxFQUFBLHFDQUFBdUQsSUFBQSxjQUFBdkQsRUFBQSxnQkFBQXlILE9BQ0F6SCxFQUFBLGdCQUFBb0gsR0FBQSxTQUFBLFdBQ0FwSCxFQUFBLHFDQUFBdUQsSUFBQSxjQUFBdkQsRUFBQXNELE1BQUFtRSxPQUNBYixNQUdBNUcsRUFBQSxjQUFBb0gsR0FBQSxTQUFBLFdBQ0FwSCxFQUFBLHlCQUFBdUQsSUFBQSxZQUFBdkQsRUFBQXNELE1BQUFtRSxNQUFBLE1BQ0FiLEtBR0EsSUFBQWMsSUFBQXhELFNBQUF5RCxjQUFBLHFCQUNBUCxHQUFBLFNBQUEsU0FBQVEsR0FDQXRFLEtBQUF1RSxPQUFBckcsTUFBQSxJQUFBb0csRUFDQTVILEVBQUEscUNBQUF1RCxJQUFBLFFBQUEsSUFBQXFFLEdBQ0FoQixNQUdBNUcsRUFBQSxnQkFBQTRFLE1BQUEsV0FDQUosWUFBQXhFLEVBQUEsYUFDQXlFLFdBQUEsU0FBQUMsR0FFQTFFLEVBQUEsc0JBQUEwQixLQUFBZ0QsR0FDQTFFLEVBQUEsYUFBQXlCLFNBQUEsY0FLQXpCLEVBQUEsYUFBQTRFLE1BQUEsV0FDQTVFLEVBQUFzRCxNQUFBckQsWUFBQSxnREFNQSxHQUFBNkgsR0FBQXhFLElBQ0FBLE1BQUErQixPQUNBckYsRUFBQSxpQkFBQW9ILEdBQUEsUUFBQSxTQUFBdEMsR0FDQUEsRUFBQW9CLGlCQUNBNEIsRUFBQXpDLE1BQUFHLG1EQU1BLEdBQUFzQyxHQUFBeEUsSUFDQUEsTUFBQStCLE9BQ0FyRixFQUFBLGVBQUFvSCxHQUFBLFFBQUEsU0FBQXRDLEdBQ0FBLEVBQUFvQixpQkFDQTRCLEVBQUF6QyxNQUFBMEMsb0JDaEpBL0gsR0FBQWdJLGFBQ0FuQyxPQUFBN0YsRUFBQWlJLE9BQ0FBLE9BQUEvRCxVQUFBZ0UsTUFBQSxTQUFBbEksR0FDQSxHQUFBb0YsTUFFQVMsT0FBQXNDLFlBQUEsV0FDQXZILEdBQUF3SCxNQUNBQyxNQUFBLG1CQUNBekcsUUFBQSxFQUNBMEcsUUFBQSxFQUNBQyxPQUFBLEVBQ0FDLFdBQUEsMEJBQ0FDLFFBQUEsVUFJQSxTQUFBQyxFQUFBQyxFQUFBN0gsR0FDQSxHQUFBOEgsR0FBQUMsRUFBQUgsRUFBQUkscUJBQUFILEdBQUEsRUFDQUQsR0FBQUssZUFBQWpJLEtBQ0E4SCxFQUFBRixFQUFBdkUsY0FBQXdFLEdBQUFDLEVBQUE5SCxHQUFBQSxFQUNBOEgsRUFBQUksSUFBQSxzQ0FDQUgsRUFBQUksV0FBQUMsYUFBQU4sRUFBQUMsS0FDQTNFLFNBQUEsU0FBQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgSW1hZ2VJdGVtIHtcclxuICAgIGNvbnN0cnVjdG9yKHVybCwgdGV4dFcgPSAxMDAsIHRleHRIID0gMTAwLCB0b3AgPSAwLCBsZWZ0ID0gMCwgcm90YXRlID0gMCwgdGV4dCA9IFwiXCIpIHtcclxuICAgICAgICB0aGlzLnVybCA9IHVybDtcclxuICAgICAgICB0aGlzLnRleHQgPSB0ZXh0O1xyXG4gICAgICAgIHRoaXMudGV4dFcgPSB0ZXh0VztcclxuICAgICAgICB0aGlzLnRleHRIID0gdGV4dEg7XHJcbiAgICAgICAgdGhpcy50b3AgPSB0b3A7XHJcbiAgICAgICAgdGhpcy5sZWZ0ID0gbGVmdDtcclxuICAgICAgICB0aGlzLnJvdGF0ZSA9IHJvdGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBhcHBlbmRUb0RvbUVsZW1lbnQoKSB7XHJcbiAgICAgICAgbGV0IGh0bWwgPSAnPGRpdiBjbGFzcz1cInByLWJvZHlcIj4nICtcclxuICAgICAgICAgICAgJzxpbWcgaWQ9XCJwci1pbWFnZVwiIHNyYz1cIicgKyB0aGlzLnVybCArICdcIiAvPicgK1xyXG4gICAgICAgICAgICAnPGRpdiBpZD1cInByLXRleHRcIj4nICtcclxuICAgICAgICAgICAgdGhpcy50ZXh0ICtcclxuICAgICAgICAgICAgJzwvZGl2PicgK1xyXG4gICAgICAgICAgICAnPC9kaXY+JztcclxuICAgICAgICAkKCcjcHJldmlldycpLmh0bWwoaHRtbCk7XHJcblxyXG4gICAgICAgICQoJyNwci10ZXh0JykuY3NzKHtcclxuICAgICAgICAgICAgJ3dpZHRoJzogdGhpcy50ZXh0VyxcclxuICAgICAgICAgICAgJ2hlaWdodCc6IHRoaXMudGV4dEgsXHJcbiAgICAgICAgICAgICd0b3AnOiB0aGlzLnRvcCxcclxuICAgICAgICAgICAgJ2xlZnQnOiB0aGlzLmxlZnQsXHJcbiAgICAgICAgICAgICctd2Via2l0LXRyYW5zZm9ybSc6ICdyb3RhdGUoJyArIHRoaXMucm90YXRlICsgJyknLFxyXG4gICAgICAgICAgICAnLW1vei10cmFuc2Zvcm0nOiAncm90YXRlKCcgKyB0aGlzLnJvdGF0ZSArICcpJyxcclxuICAgICAgICAgICAgJy1tcy10cmFuc2Zvcm0nOiAncm90YXRlKCcgKyB0aGlzLnJvdGF0ZSArICcpJyxcclxuICAgICAgICAgICAgJy1vLXRyYW5zZm9ybSc6ICdyb3RhdGUoJyArIHRoaXMucm90YXRlICsgJyknLFxyXG4gICAgICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgnICsgdGhpcy5yb3RhdGUgKyAnKSdcclxuICAgICAgICB9KTtcclxuICAgICAgICAkKCcjbWluaS1pbWFnZSBpbWcsICNtaW5pLXJlc3VsdCBpbWcnKS5hdHRyKCdzcmMnLCB0aGlzLnVybCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VGV4dCh0ZXh0ID0gXCJcIikge1xyXG4gICAgICAgIHRoaXMudGV4dCA9IHRleHQ7XHJcbiAgICAgICAgJCgnI3ByLXRleHQnKS5odG1sKHRoaXMudGV4dCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VGV4dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50ZXh0O1xyXG4gICAgfVxyXG5cclxuICAgIHNhdmVJbWFnZSgpIHtcclxuICAgICAgICBsZXQgbGluaztcclxuICAgICAgICBpZiAoISQoJ2EnKS5pcygnI2Rvd25sb2FkJykpIHtcclxuICAgICAgICAgICAgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgICAgbGluay5pbm5lckhUTUwgPSAnZG93bmxvYWQgaW1hZ2UnO1xyXG4gICAgICAgICAgICBsaW5rLmlkID0gJ2Rvd25sb2FkJztcclxuICAgICAgICAgICAgbGluay5kb3dubG9hZCA9IFwibm9uYW1lLnBuZ1wiO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGluayA9ICQoJ2EjZG93bmxvYWQnKS5nZXQoMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoISQoXCJkaXZcIikuaXMoXCIjcHJldmlld1wiKSlcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIGh0bWwyY2FudmFzKCQoXCIjcHJldmlld1wiKSwge1xyXG4gICAgICAgICAgICBvbnJlbmRlcmVkOiBmdW5jdGlvbiAoY2FudmFzKSB7XHJcbiAgICAgICAgICAgICAgICAvL2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTtcclxuICAgICAgICAgICAgICAgIC8vbGluay5ocmVmID0gY2FudmFzLnRvRGF0YVVSTCgpO1xyXG4gICAgICAgICAgICAgICAgJChsaW5rKS5hdHRyKCdocmVmJywgY2FudmFzLnRvRGF0YVVSTCgpKTtcclxuICAgICAgICAgICAgICAgIGxpbmsuY2xpY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNoYXJlRkIoKSB7XHJcbiAgICAgICAgaHRtbDJjYW52YXMoJChcIiNwcmV2aWV3XCIpLCB7XHJcbiAgICAgICAgICAgIG9ucmVuZGVyZWQ6IGZ1bmN0aW9uIChjYW52YXMpIHtcclxuICAgICAgICAgICAgICAgIGxldCBkYXRhID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gZGF0YVVSSXRvQmxvYihkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIEZCLmdldExvZ2luU3RhdHVzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSBcImNvbm5lY3RlZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RJbWFnZVRvRmFjZWJvb2socmVzcG9uc2UuYXV0aFJlc3BvbnNlLmFjY2Vzc1Rva2VuLCBcIkNhbnZhcyB0byBGYWNlYm9va1wiLCBcImltYWdlL3BuZ1wiLCBibG9iLCBcImh0dHA6Ly9iaXQubHkvMVFLMFFic3pcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IFwibm90X2F1dGhvcml6ZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBGQi5sb2dpbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RJbWFnZVRvRmFjZWJvb2socmVzcG9uc2UuYXV0aFJlc3BvbnNlLmFjY2Vzc1Rva2VuLCBcIkNhbnZhcyB0byBGYWNlYm9va1wiLCBcImltYWdlL3BuZ1wiLCBibG9iLCBcImh0dHA6Ly9iaXQubHkvMVFLMFFic3pcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtzY29wZTogXCJwdWJsaXNoX2FjdGlvbnNcIn0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEZCLmxvZ2luKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdEltYWdlVG9GYWNlYm9vayhyZXNwb25zZS5hdXRoUmVzcG9uc2UuYWNjZXNzVG9rZW4sIFwiQ2FudmFzIHRvIEZhY2Vib29rXCIsIFwiaW1hZ2UvcG5nXCIsIGJsb2IsIFwiaHR0cDovL2JpdC5seS8xUUswUWJzelwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwge3Njb3BlOiBcInB1Ymxpc2hfYWN0aW9uc1wifSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcG9zdEltYWdlVG9GYWNlYm9vayh0b2tlbiwgZmlsZW5hbWUsIG1pbWVUeXBlLCBpbWFnZURhdGEsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgZmQuYXBwZW5kKFwiYWNjZXNzX3Rva2VuXCIsIHRva2VuKTtcclxuICAgIGZkLmFwcGVuZChcInNvdXJjZVwiLCBpbWFnZURhdGEpO1xyXG4gICAgZmQuYXBwZW5kKFwibm9fc3RvcnlcIiwgdHJ1ZSk7XHJcblxyXG4gICAgJCgnLnByZWxvYWRlcicpLnJlbW92ZUNsYXNzKCdkaXNhYmxlJyk7XHJcbiAgICBcclxuICAgIC8vIFVwbG9hZCBpbWFnZSB0byBmYWNlYm9vayB3aXRob3V0IHN0b3J5KHBvc3QgdG8gZmVlZClcclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiBcImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL3Bob3Rvcz9hY2Nlc3NfdG9rZW49XCIgKyB0b2tlbixcclxuICAgICAgICB0eXBlOiBcIlBPU1RcIixcclxuICAgICAgICBkYXRhOiBmZCxcclxuICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXHJcbiAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxyXG4gICAgICAgIGNhY2hlOiBmYWxzZSxcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInN1Y2Nlc3M6IFwiLCBkYXRhKTtcclxuICAgICAgICAgICAgLy8gR2V0IGltYWdlIHNvdXJjZSB1cmxcclxuICAgICAgICAgICAgRkIuYXBpKFxyXG4gICAgICAgICAgICAgICAgXCIvXCIgKyBkYXRhLmlkICsgXCI/ZmllbGRzPWltYWdlc1wiLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmICFyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLmltYWdlc1swXS5zb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgZmFjZWJvb2sgcG9zdCB1c2luZyBpbWFnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBGQi5hcGkoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi9tZS9mZWVkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1lc3NhZ2VcIjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBpY3R1cmVcIjogcmVzcG9uc2UuaW1hZ2VzWzBdLnNvdXJjZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxpbmtcIjogIHJlc3BvbnNlLmltYWdlc1swXS5zb3VyY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6ICdUcnkgdG8gZG8gdGhlIHNhbWUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjogbWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByaXZhY3lcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ1NFTEYnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiAhcmVzcG9uc2UuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogaGFuZGxlIHRoZSByZXN1bHQgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJQb3N0ZWQgc3RvcnkgdG8gZmFjZWJvb2tcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnByZWxvYWRlcicpLmFkZENsYXNzKCdkaXNhYmxlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcucHItbW9kYWwgLnByLWJvZHknKS5odG1sKCc8aDIgY2xhc3M9XCJ0ZXh0LWNlbnRlclwiPlNoYXJlZCBvbiBmYWNlYm9vazwvaDI+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5wci1tb2RhbCcpLmFkZENsYXNzKCdzaG93bicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHNociwgc3RhdHVzLCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgXCIgKyBkYXRhICsgXCIgU3RhdHVzIFwiICsgc2hyLnN0YXR1cyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1Bvc3QgdG8gZmFjZWJvb2sgQ29tcGxldGUnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZGF0YVVSSXRvQmxvYihkYXRhVVJJKSB7XHJcbiAgICAvLyBjb252ZXJ0IGJhc2U2NC9VUkxFbmNvZGVkIGRhdGEgY29tcG9uZW50IHRvIHJhdyBiaW5hcnkgZGF0YSBoZWxkIGluIGEgc3RyaW5nXHJcbiAgICB2YXIgYnl0ZVN0cmluZztcclxuICAgIGlmIChkYXRhVVJJLnNwbGl0KCcsJylbMF0uaW5kZXhPZignYmFzZTY0JykgPj0gMClcclxuICAgICAgICBieXRlU3RyaW5nID0gYXRvYihkYXRhVVJJLnNwbGl0KCcsJylbMV0pO1xyXG4gICAgZWxzZVxyXG4gICAgICAgIGJ5dGVTdHJpbmcgPSB1bmVzY2FwZShkYXRhVVJJLnNwbGl0KCcsJylbMV0pO1xyXG5cclxuICAgIC8vIHNlcGFyYXRlIG91dCB0aGUgbWltZSBjb21wb25lbnRcclxuICAgIHZhciBtaW1lU3RyaW5nID0gZGF0YVVSSS5zcGxpdCgnLCcpWzBdLnNwbGl0KCc6JylbMV0uc3BsaXQoJzsnKVswXTtcclxuXHJcbiAgICAvLyB3cml0ZSB0aGUgYnl0ZXMgb2YgdGhlIHN0cmluZyB0byBhIHR5cGVkIGFycmF5XHJcbiAgICB2YXIgaWEgPSBuZXcgVWludDhBcnJheShieXRlU3RyaW5nLmxlbmd0aCk7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5dGVTdHJpbmcubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpYVtpXSA9IGJ5dGVTdHJpbmcuY2hhckNvZGVBdChpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3IEJsb2IoW2lhXSwge3R5cGU6bWltZVN0cmluZ30pO1xyXG59IiwiY2xhc3MgTWFpbiB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmltYWdlO1xyXG5cclxuICAgICAgICB0aGlzLndpbmRvd0xvYWQoKTtcclxuICAgICAgICB0aGlzLmVkaXRQYWdlRXZlbnRzKCk7XHJcbiAgICAgICAgdGhpcy5zYXZlSW1hZ2UoKTtcclxuICAgICAgICB0aGlzLnNoYXJlSW1hZ2UoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgd2luZG93TG9hZCgpIHtcclxuICAgICAgICAkKCcuaXRlbXMgLml0ZW0taW1hZ2UnKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGltZ1NyYyA9ICQoJ2ltZycsIHRoaXMpLmF0dHIoJ3NyYycpO1xyXG4gICAgICAgICAgICBpZiAoaW1nU3JjKSB7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcygnYmFja2dyb3VuZC1pbWFnZScsICd1cmwoXCInICsgaW1nU3JjICsgJ1wiKScpO1xyXG4gICAgICAgICAgICAgICAgJCgnaW1nJywgdGhpcykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCh3aW5kb3cpLmxvYWQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKFwiLnNjcm9sbGJhclwiKS5tQ3VzdG9tU2Nyb2xsYmFyKHtcclxuICAgICAgICAgICAgICAgIGF4aXM6XCJ4eVwiLFxyXG4gICAgICAgICAgICAgICAgdGhlbWU6IFwiaW5zZXQtMi1kYXJrXCJcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcucHJlbG9hZGVyJykuYWRkQ2xhc3MoJ2Rpc2FibGUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCgnLml0ZW1zIC5pdGVtLWZyYW1lJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGltYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAkKHRoaXMpLmRhdGEoJ3VybCcpLFxyXG4gICAgICAgICAgICAgICAgdGV4dFdpZHRoOiAkKHRoaXMpLmRhdGEoJ3RleHQtd2lkdGgnKSxcclxuICAgICAgICAgICAgICAgIHRleHRIZWlnaHQ6ICQodGhpcykuZGF0YSgndGV4dC1oZWlnaHQnKSxcclxuICAgICAgICAgICAgICAgIHRvcDogJCh0aGlzKS5kYXRhKCd0b3AnKSxcclxuICAgICAgICAgICAgICAgIGxlZnQ6ICQodGhpcykuZGF0YSgnbGVmdCcpLFxyXG4gICAgICAgICAgICAgICAgcm90YXRlOiAkKHRoaXMpLmRhdGEoJ3JvdGF0ZScpXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnaW1hZ2UnLCBKU09OLnN0cmluZ2lmeShpbWFnZSkpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gXCIvZWRpdC5odG1sXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0UGFnZUV2ZW50cygpIHtcclxuICAgICAgICBsZXQgdGltZU91dElkID0gbnVsbDtcclxuXHJcbiAgICAgICAgbGV0IHByZXZpZXdVcGRhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aW1lT3V0SWQpXHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZU91dElkKTtcclxuXHJcbiAgICAgICAgICAgIHRpbWVPdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaHRtbDJjYW52YXMoJChcIiNwcmV2aWV3XCIpLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25yZW5kZXJlZDogZnVuY3Rpb24oY2FudmFzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbWluaS1yZXN1bHQgLml0ZW0taW1hZ2UnKS5odG1sKGNhbnZhcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi50b1N0cmluZygpLmluZGV4T2YoJ2VkaXQuaHRtbCcpID4gLTEgJiYgIXNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2ltYWdlJykpIHtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gXCIvXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJChcImRpdlwiKS5pcyhcIiNwcmV2aWV3XCIpICYmIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2ltYWdlJykpIHtcclxuICAgICAgICAgICAgdmFyIGltYWdlID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdpbWFnZScpKTtcclxuICAgICAgICAgICAgdmFyIGltZ09iaiA9IG5ldyBJbWFnZUl0ZW0oaW1hZ2UudXJsLCBpbWFnZS50ZXh0V2lkdGgsIGltYWdlLnRleHRIZWlnaHQsIGltYWdlLnRvcCwgaW1hZ2UubGVmdCwgaW1hZ2Uucm90YXRlKTtcclxuICAgICAgICAgICAgdGhpcy5pbWFnZSA9IGltZ09iajtcclxuICAgICAgICAgICAgaW1nT2JqLmFwcGVuZFRvRG9tRWxlbWVudCgpO1xyXG5cclxuICAgICAgICAgICAgJCgnI2lucHV0LXRleHQnKS5vbihcImtleXVwXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoJyNtaW5pLXRleHQgLml0ZW0taW1hZ2UnKS5odG1sKCQodGhpcykuaHRtbCgpKTtcclxuICAgICAgICAgICAgICAgIGltZ09iai5zZXRUZXh0KCQodGhpcykuaHRtbCgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3VXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnI2lucHV0LXRleHQnKS5rZXlkb3duKGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRyYXAgdGhlIHJldHVybiBrZXkgYmVpbmcgcHJlc3NlZFxyXG4gICAgICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpbnNlcnQgMiBiciB0YWdzIChpZiBvbmx5IG9uZSBiciB0YWcgaXMgaW5zZXJ0ZWQgdGhlIGN1cnNvciB3b24ndCBnbyB0byB0aGUgbmV4dCBsaW5lKVxyXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRIVE1MJywgZmFsc2UsICc8YnI+PGJyPicpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgdGhlIGRlZmF1bHQgYmVoYXZpb3VyIG9mIHJldHVybiBrZXkgcHJlc3NlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcjaW5wdXQtdGV4dCwgI3ByLXRleHQsICNtaW5pLXRleHQnKS5jc3MoJ2ZvbnQtZmFtaWx5JywgJCgnI3NlbGVjdC1mb250JykudmFsKCkpO1xyXG4gICAgICAgICAgICAkKCcjc2VsZWN0LWZvbnQnKS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkKCcjaW5wdXQtdGV4dCwgI3ByLXRleHQsICNtaW5pLXRleHQnKS5jc3MoJ2ZvbnQtZmFtaWx5JywgJCh0aGlzKS52YWwoKSk7XHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3VXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnI2ZvbnQtc2l6ZScpLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoJyNpbnB1dC10ZXh0LCAjcHItdGV4dCcpLmNzcygnZm9udC1zaXplJywgJCh0aGlzKS52YWwoKSArICdweCcpO1xyXG4gICAgICAgICAgICAgICAgcHJldmlld1VwZGF0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBwaWNrZXIgPSBuZXcgQ1AoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQjZm9udC1jb2xvcicpKTtcclxuICAgICAgICAgICAgcGlja2VyLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKGNvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldC52YWx1ZSA9ICcjJyArIGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgJCgnI2lucHV0LXRleHQsICNwci10ZXh0LCAjbWluaS10ZXh0JykuY3NzKCdjb2xvcicsICcjJyArIGNvbG9yKTtcclxuICAgICAgICAgICAgICAgIHByZXZpZXdVcGRhdGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcjbWluaS1yZXN1bHQnKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBodG1sMmNhbnZhcygkKFwiI3ByZXZpZXdcIiksIHtcclxuICAgICAgICAgICAgICAgICAgICBvbnJlbmRlcmVkOiBmdW5jdGlvbihjYW52YXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5wci1tb2RhbCAucHItYm9keScpLmh0bWwoY2FudmFzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnByLW1vZGFsJykuYWRkQ2xhc3MoJ3Nob3duJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnLnByLW1vZGFsJykuY2xpY2soZnVuY3Rpb24gKCl7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdzaG93bicpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZUltYWdlKCkge1xyXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoaXMuaW1hZ2UpIHtcclxuICAgICAgICAgICAgJCgnI2J0bi1kb3dubG9hZCcpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmltYWdlLnNhdmVJbWFnZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2hhcmVJbWFnZSgpIHtcclxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLmltYWdlKSB7XHJcbiAgICAgICAgICAgICQoJyNidG4tcG9zdGVyJykub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuaW1hZ2Uuc2hhcmVGQigpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59IiwiJC5ub0NvbmZsaWN0KCk7XHJcbndpbmRvdy4kID0galF1ZXJ5O1xyXG5qUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgkKSB7XHJcbiAgICBuZXcgTWFpbigpO1xyXG5cclxuICAgIHdpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIEZCLmluaXQoe1xyXG4gICAgICAgICAgICBhcHBJZCAgICAgIDogJzEzMjgzNjE3NzM4OTU3MzYnLFxyXG4gICAgICAgICAgICBzdGF0dXM6IHRydWUsXHJcbiAgICAgICAgICAgIGNvb2tpZTogdHJ1ZSxcclxuICAgICAgICAgICAgeGZibWw6IHRydWUsXHJcbiAgICAgICAgICAgIGNoYW5uZWxVcmwgOiAnLy9kZW1vLnlvdXJzaXRlcy5vbmxpbmUnLFxyXG4gICAgICAgICAgICB2ZXJzaW9uICAgIDogJ3YyLjgnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIChmdW5jdGlvbihkLCBzLCBpZCl7XHJcbiAgICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xyXG4gICAgICAgIGlmIChkLmdldEVsZW1lbnRCeUlkKGlkKSkge3JldHVybjt9XHJcbiAgICAgICAganMgPSBkLmNyZWF0ZUVsZW1lbnQocyk7IGpzLmlkID0gaWQ7XHJcbiAgICAgICAganMuc3JjID0gXCIvL2Nvbm5lY3QuZmFjZWJvb2submV0L2VuX1VTL3Nkay5qc1wiO1xyXG4gICAgICAgIGZqcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgZmpzKTtcclxuICAgIH0oZG9jdW1lbnQsICdzY3JpcHQnLCAnZmFjZWJvb2stanNzZGsnKSk7XHJcbn0pOyJdfQ==
