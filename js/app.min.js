'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var ImageItem = function () {
    function ImageItem(url) {
        var textW = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100;
        var textH = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 100;
        var top = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
        var left = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
        var rotate = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
        var text = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : "";

        _classCallCheck(this, ImageItem);

        this.url = url;
        this.text = text;
        this.textW = textW;
        this.textH = textH;
        this.top = top;
        this.left = left;
        this.rotate = rotate;
    }

    _createClass(ImageItem, [{
        key: 'appendToDomElement',
        value: function appendToDomElement() {
            var html = '<div class="pr-body">' + '<img id="pr-image" src="' + this.url + '" />' + '<div id="pr-text">' + this.text + '</div>' + '</div>';
            $('#preview').html(html);

            $('#pr-text').css({
                'width': this.textW,
                'height': this.textH,
                'top': this.top,
                'left': this.left,
                '-webkit-transform': 'rotate(' + this.rotate + ')',
                '-moz-transform': 'rotate(' + this.rotate + ')',
                '-ms-transform': 'rotate(' + this.rotate + ')',
                '-o-transform': 'rotate(' + this.rotate + ')',
                'transform': 'rotate(' + this.rotate + ')'
            });
            $('#mini-image img, #mini-result img').attr('src', this.url);
        }
    }, {
        key: 'setText',
        value: function setText() {
            var text = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";

            this.text = text;
            $('#pr-text').html(this.text);
        }
    }, {
        key: 'getText',
        value: function getText() {
            return this.text;
        }
    }, {
        key: 'saveImage',
        value: function saveImage() {
            var link = void 0;
            if (!$('a').is('#download')) {
                link = document.createElement('a');
                link.innerHTML = 'download image';
                link.id = 'download';
                link.download = "noname.png";
                document.body.appendChild(link);
            } else {
                link = $('a#download').get(0);
            }

            if (!$("div").is("#preview")) return;
            html2canvas($("#preview"), {
                onrendered: function onrendered(canvas) {
                    //document.body.appendChild(canvas);
                    //link.href = canvas.toDataURL();
                    $(link).attr('href', canvas.toDataURL());
                    link.click();
                }
            });
        }
    }, {
        key: 'shareFB',
        value: function shareFB() {}
    }, {
        key: 'upload',
        value: function upload() {
            html2canvas($("#preview"), {
                onrendered: function onrendered(canvas) {
                    $.ajax({
                        type: "POST",
                        url: "upload.php",
                        data: {
                            img: canvas.toDataURL()
                        }
                    }).done(function (response) {
                        console.log(response);
                        FB.ui({
                            method: 'share',
                            href: 'http://demo.yoursites.online/' + response,
                            image: 'http://demo.yoursites.online/' + response
                        }, function (response) {

                            //TODO Proper response handling
                            log(response);
                            if (typeof response != 'undefined') {
                                alert('Thanks for sharing');
                            }
                        });
                    }).error(function (error) {
                        console.warn(error);
                    });
                }
            });
        }
    }]);

    return ImageItem;
}();

var Main = function () {
    function Main() {
        _classCallCheck(this, Main);

        this.image;

        this.windowLoad();
        this.editPageEvents();
        this.saveImage();
        this.uploadImage();
    }

    _createClass(Main, [{
        key: 'windowLoad',
        value: function windowLoad() {
            $('.items .item-image').each(function () {
                var imgSrc = $('img', this).attr('src');
                if (imgSrc) {
                    $(this).css('background-image', 'url("' + imgSrc + '")');
                    $('img', this).remove();
                }
            });

            $(window).load(function () {
                $(".scrollbar").mCustomScrollbar({
                    axis: "xy",
                    theme: "inset-2-dark"
                });
            });

            $('.items .item-frame').click(function (e) {
                e.preventDefault();

                var image = {
                    url: $(this).data('url'),
                    textWidth: $(this).data('text-width'),
                    textHeight: $(this).data('text-height'),
                    top: $(this).data('top'),
                    left: $(this).data('left'),
                    rotate: $(this).data('rotate')
                };

                try {
                    sessionStorage.setItem('image', JSON.stringify(image));
                    window.location = "/edit.html";
                } catch (ex) {
                    console.log(ex);
                }
            });
        }
    }, {
        key: 'editPageEvents',
        value: function editPageEvents() {
            var timeOutId = null;

            var previewUpdate = function previewUpdate() {
                if (timeOutId) clearTimeout(timeOutId);

                timeOutId = setTimeout(function () {
                    html2canvas($("#preview"), {
                        onrendered: function onrendered(canvas) {
                            //document.body.appendChild(canvas);
                            $('#mini-result .item-image').html(canvas);
                        }
                    });
                }, 1000);
            };

            if (window.location.toString().indexOf('edit.html') > -1 && !sessionStorage.getItem('image')) {
                window.location = "/";
            }

            if ($("div").is("#preview") && sessionStorage.getItem('image')) {
                var image = JSON.parse(sessionStorage.getItem('image'));
                var imgObj = new ImageItem(image.url, image.textWidth, image.textHeight, image.top, image.left, image.rotate);
                this.image = imgObj;
                imgObj.appendToDomElement();

                $('#input-text').on("keyup", function () {
                    $('#mini-text .item-image').html($(this).html());
                    imgObj.setText($(this).html());

                    previewUpdate();
                });

                $('#input-text').keydown(function (e) {
                    // trap the return key being pressed
                    if (e.keyCode === 13) {
                        // insert 2 br tags (if only one br tag is inserted the cursor won't go to the next line)
                        document.execCommand('insertHTML', false, '<br><br>');
                        // prevent the default behaviour of return key pressed
                        return false;
                    }
                });

                $('#input-text, #pr-text').css('font-family', $('#select-font').val());
                $('#select-font').on("change", function () {
                    $('#input-text, #pr-text').css('font-family', $(this).val());
                    previewUpdate();
                });

                $('#font-size').on("change", function () {
                    $('#input-text, #pr-text').css('font-size', $(this).val() + 'px');
                    previewUpdate();
                });

                var picker = new CP(document.querySelector('input#font-color'));
                picker.on("change", function (color) {
                    this.target.value = '#' + color;
                    $('#input-text, #pr-text').css('color', '#' + color);
                    previewUpdate();
                });

                $('#mini-result').click(function () {
                    html2canvas($("#preview"), {
                        onrendered: function onrendered(canvas) {
                            //document.body.appendChild(canvas);
                            $('.pr-modal .pr-body').html(canvas);
                            $('.pr-modal').addClass('shown');
                        }
                    });
                });

                $('.pr-modal').click(function () {
                    $(this).removeClass('shown');
                });
            }
        }
    }, {
        key: 'saveImage',
        value: function saveImage() {
            var _this = this;
            if (this.image) {
                $('#btn-download').on("click", function (e) {
                    e.preventDefault();
                    _this.image.saveImage();
                });
            }
        }
    }, {
        key: 'uploadImage',
        value: function uploadImage() {
            var _this = this;
            if (this.image) {
                $('#btn-poster').on("click", function (e) {
                    e.preventDefault();
                    _this.image.upload();
                });
            }
        }
    }]);

    return Main;
}();

$.noConflict();
window.$ = jQuery;
jQuery(document).ready(function ($) {
    new Main();

    window.fbAsyncInit = function () {
        FB.init({
            appId: '1328361773895736',
            status: true,
            cookie: true,
            xfbml: true,
            channelUrl: '//demo.yoursites.online',
            version: 'v2.8'
        });
    };

    (function (d, s, id) {
        var js,
            fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {
            return;
        }
        js = d.createElement(s);js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    })(document, 'script', 'facebook-jssdk');
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImltYWdlLmpzIiwibWFpbi5qcyIsImFwcC5qcyJdLCJuYW1lcyI6WyJJbWFnZUl0ZW0iLCJ1cmwiLCJ0ZXh0VyIsInRleHRIIiwidG9wIiwibGVmdCIsInJvdGF0ZSIsInRleHQiLCJodG1sIiwiJCIsImNzcyIsImF0dHIiLCJsaW5rIiwiaXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJpZCIsImRvd25sb2FkIiwiYm9keSIsImFwcGVuZENoaWxkIiwiZ2V0IiwiaHRtbDJjYW52YXMiLCJvbnJlbmRlcmVkIiwiY2FudmFzIiwidG9EYXRhVVJMIiwiY2xpY2siLCJhamF4IiwidHlwZSIsImRhdGEiLCJpbWciLCJkb25lIiwicmVzcG9uc2UiLCJjb25zb2xlIiwibG9nIiwiRkIiLCJ1aSIsIm1ldGhvZCIsImhyZWYiLCJpbWFnZSIsImFsZXJ0IiwiZXJyb3IiLCJ3YXJuIiwiTWFpbiIsIndpbmRvd0xvYWQiLCJlZGl0UGFnZUV2ZW50cyIsInNhdmVJbWFnZSIsInVwbG9hZEltYWdlIiwiZWFjaCIsImltZ1NyYyIsInJlbW92ZSIsIndpbmRvdyIsImxvYWQiLCJtQ3VzdG9tU2Nyb2xsYmFyIiwiYXhpcyIsInRoZW1lIiwiZSIsInByZXZlbnREZWZhdWx0IiwidGV4dFdpZHRoIiwidGV4dEhlaWdodCIsInNlc3Npb25TdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJsb2NhdGlvbiIsImV4IiwidGltZU91dElkIiwicHJldmlld1VwZGF0ZSIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJ0b1N0cmluZyIsImluZGV4T2YiLCJnZXRJdGVtIiwicGFyc2UiLCJpbWdPYmoiLCJhcHBlbmRUb0RvbUVsZW1lbnQiLCJvbiIsInNldFRleHQiLCJrZXlkb3duIiwia2V5Q29kZSIsImV4ZWNDb21tYW5kIiwidmFsIiwicGlja2VyIiwiQ1AiLCJxdWVyeVNlbGVjdG9yIiwiY29sb3IiLCJ0YXJnZXQiLCJ2YWx1ZSIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJfdGhpcyIsInVwbG9hZCIsIm5vQ29uZmxpY3QiLCJqUXVlcnkiLCJyZWFkeSIsImZiQXN5bmNJbml0IiwiaW5pdCIsImFwcElkIiwic3RhdHVzIiwiY29va2llIiwieGZibWwiLCJjaGFubmVsVXJsIiwidmVyc2lvbiIsImQiLCJzIiwianMiLCJmanMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0lBQUFBLFM7QUFDQSx1QkFBQUMsR0FBQSxFQUFBO0FBQUEsWUFBQUMsS0FBQSx1RUFBQSxHQUFBO0FBQUEsWUFBQUMsS0FBQSx1RUFBQSxHQUFBO0FBQUEsWUFBQUMsR0FBQSx1RUFBQSxDQUFBO0FBQUEsWUFBQUMsSUFBQSx1RUFBQSxDQUFBO0FBQUEsWUFBQUMsTUFBQSx1RUFBQSxDQUFBO0FBQUEsWUFBQUMsSUFBQSx1RUFBQSxFQUFBOztBQUFBOztBQUNBLGFBQUFOLEdBQUEsR0FBQUEsR0FBQTtBQUNBLGFBQUFNLElBQUEsR0FBQUEsSUFBQTtBQUNBLGFBQUFMLEtBQUEsR0FBQUEsS0FBQTtBQUNBLGFBQUFDLEtBQUEsR0FBQUEsS0FBQTtBQUNBLGFBQUFDLEdBQUEsR0FBQUEsR0FBQTtBQUNBLGFBQUFDLElBQUEsR0FBQUEsSUFBQTtBQUNBLGFBQUFDLE1BQUEsR0FBQUEsTUFBQTtBQUNBOzs7OzZDQUVBO0FBQ0EsZ0JBQUFFLE9BQUEsMEJBQ0EsMEJBREEsR0FDQSxLQUFBUCxHQURBLEdBQ0EsTUFEQSxHQUVBLG9CQUZBLEdBR0EsS0FBQU0sSUFIQSxHQUlBLFFBSkEsR0FLQSxRQUxBO0FBTUFFLGNBQUEsVUFBQSxFQUFBRCxJQUFBLENBQUFBLElBQUE7O0FBRUFDLGNBQUEsVUFBQSxFQUFBQyxHQUFBLENBQUE7QUFDQSx5QkFBQSxLQUFBUixLQURBO0FBRUEsMEJBQUEsS0FBQUMsS0FGQTtBQUdBLHVCQUFBLEtBQUFDLEdB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QUEsRUFBQUMsQ0FBQSxFQUFBdkYsRUFBQSxFQUFBO0FBQ0EsWUFBQXdGLEVBQUE7QUFBQSxZQUFBQyxNQUFBSCxFQUFBSSxvQkFBQSxDQUFBSCxDQUFBLEVBQUEsQ0FBQSxDQUFBO0FBQ0EsWUFBQUQsRUFBQUssY0FBQSxDQUFBM0YsRUFBQSxDQUFBLEVBQUE7QUFBQTtBQUFBO0FBQ0F3RixhQUFBRixFQUFBeEYsYUFBQSxDQUFBeUYsQ0FBQSxDQUFBLENBQUFDLEdBQUF4RixFQUFBLEdBQUFBLEVBQUE7QUFDQXdGLFdBQUFJLEdBQUEsR0FBQSxxQ0FBQTtBQUNBSCxZQUFBSSxVQUFBLENBQUFDLFlBQUEsQ0FBQU4sRUFBQSxFQUFBQyxHQUFBO0FBQ0EsS0FOQSxFQU1BNUYsUUFOQSxFQU1BLFFBTkEsRUFNQSxnQkFOQSxDQUFBO0FBT0EsQ0FyQkEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEltYWdlSXRlbSB7XHJcbiAgICBjb25zdHJ1Y3Rvcih1cmwsIHRleHRXID0gMTAwLCB0ZXh0SCA9IDEwMCwgdG9wID0gMCwgbGVmdCA9IDAsIHJvdGF0ZSA9IDAsIHRleHQgPSBcIlwiKSB7XHJcbiAgICAgICAgdGhpcy51cmwgPSB1cmw7XHJcbiAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDtcclxuICAgICAgICB0aGlzLnRleHRXID0gdGV4dFc7XHJcbiAgICAgICAgdGhpcy50ZXh0SCA9IHRleHRIO1xyXG4gICAgICAgIHRoaXMudG9wID0gdG9wO1xyXG4gICAgICAgIHRoaXMubGVmdCA9IGxlZnQ7XHJcbiAgICAgICAgdGhpcy5yb3RhdGUgPSByb3RhdGU7XHJcbiAgICB9XHJcblxyXG4gICAgYXBwZW5kVG9Eb21FbGVtZW50KCkge1xyXG4gICAgICAgIGxldCBodG1sID0gJzxkaXYgY2xhc3M9XCJwci1ib2R5XCI+JyArXHJcbiAgICAgICAgICAgICc8aW1nIGlkPVwicHItaW1hZ2VcIiBzcmM9XCInICsgdGhpcy51cmwgKyAnXCIgLz4nICtcclxuICAgICAgICAgICAgJzxkaXYgaWQ9XCJwci10ZXh0XCI+JyArXHJcbiAgICAgICAgICAgIHRoaXMudGV4dCArXHJcbiAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgJzwvZGl2Pic7XHJcbiAgICAgICAgJCgnI3ByZXZpZXcnKS5odG1sKGh0bWwpO1xyXG5cclxuICAgICAgICAkKCcjcHItdGV4dCcpLmNzcyh7XHJcbiAgICAgICAgICAgICd3aWR0aCc6IHRoaXMudGV4dFcsXHJcbiAgICAgICAgICAgICdoZWlnaHQnOiB0aGlzLnRleHRILFxyXG4gICAgICAgICAgICAndG9wJzogdGhpcy50b3AsXHJcbiAgICAgICAgICAgICdsZWZ0JzogdGhpcy5sZWZ0LFxyXG4gICAgICAgICAgICAnLXdlYmtpdC10cmFuc2Zvcm0nOiAncm90YXRlKCcgKyB0aGlzLnJvdGF0ZSArICcpJyxcclxuICAgICAgICAgICAgJy1tb3otdHJhbnNmb3JtJzogJ3JvdGF0ZSgnICsgdGhpcy5yb3RhdGUgKyAnKScsXHJcbiAgICAgICAgICAgICctbXMtdHJhbnNmb3JtJzogJ3JvdGF0ZSgnICsgdGhpcy5yb3RhdGUgKyAnKScsXHJcbiAgICAgICAgICAgICctby10cmFuc2Zvcm0nOiAncm90YXRlKCcgKyB0aGlzLnJvdGF0ZSArICcpJyxcclxuICAgICAgICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoJyArIHRoaXMucm90YXRlICsgJyknXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCgnI21pbmktaW1hZ2UgaW1nLCAjbWluaS1yZXN1bHQgaW1nJykuYXR0cignc3JjJywgdGhpcy51cmwpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFRleHQodGV4dCA9IFwiXCIpIHtcclxuICAgICAgICB0aGlzLnRleHQgPSB0ZXh0O1xyXG4gICAgICAgICQoJyNwci10ZXh0JykuaHRtbCh0aGlzLnRleHQpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFRleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dDtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlSW1hZ2UoKSB7XHJcbiAgICAgICAgbGV0IGxpbms7XHJcbiAgICAgICAgaWYgKCEkKCdhJykuaXMoJyNkb3dubG9hZCcpKSB7XHJcbiAgICAgICAgICAgIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgICAgIGxpbmsuaW5uZXJIVE1MID0gJ2Rvd25sb2FkIGltYWdlJztcclxuICAgICAgICAgICAgbGluay5pZCA9ICdkb3dubG9hZCc7XHJcbiAgICAgICAgICAgIGxpbmsuZG93bmxvYWQgPSBcIm5vbmFtZS5wbmdcIjtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGxpbmsgPSAkKCdhI2Rvd25sb2FkJykuZ2V0KDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCEkKFwiZGl2XCIpLmlzKFwiI3ByZXZpZXdcIikpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICBodG1sMmNhbnZhcygkKFwiI3ByZXZpZXdcIiksIHtcclxuICAgICAgICAgICAgb25yZW5kZXJlZDogZnVuY3Rpb24gKGNhbnZhcykge1xyXG4gICAgICAgICAgICAgICAgLy9kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XHJcbiAgICAgICAgICAgICAgICAvL2xpbmsuaHJlZiA9IGNhbnZhcy50b0RhdGFVUkwoKTtcclxuICAgICAgICAgICAgICAgICQobGluaykuYXR0cignaHJlZicsIGNhbnZhcy50b0RhdGFVUkwoKSk7XHJcbiAgICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzaGFyZUZCKCkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB1cGxvYWQoKSB7XHJcbiAgICAgICAgaHRtbDJjYW52YXMoJChcIiNwcmV2aWV3XCIpLCB7XHJcbiAgICAgICAgICAgIG9ucmVuZGVyZWQ6IGZ1bmN0aW9uIChjYW52YXMpIHtcclxuICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcInVwbG9hZC5waHBcIixcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZzogY2FudmFzLnRvRGF0YVVSTCgpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgRkIudWkoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdzaGFyZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhyZWY6ICdodHRwOi8vZGVtby55b3Vyc2l0ZXMub25saW5lLycgKyByZXNwb25zZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6ICdodHRwOi8vZGVtby55b3Vyc2l0ZXMub25saW5lLycgKyByZXNwb25zZVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPIFByb3BlciByZXNwb25zZSBoYW5kbGluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlICE9ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgnVGhhbmtzIGZvciBzaGFyaW5nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxufSIsImNsYXNzIE1haW4ge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5pbWFnZTtcclxuXHJcbiAgICAgICAgdGhpcy53aW5kb3dMb2FkKCk7XHJcbiAgICAgICAgdGhpcy5lZGl0UGFnZUV2ZW50cygpO1xyXG4gICAgICAgIHRoaXMuc2F2ZUltYWdlKCk7XHJcbiAgICAgICAgdGhpcy51cGxvYWRJbWFnZSgpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB3aW5kb3dMb2FkKCkge1xyXG4gICAgICAgICQoJy5pdGVtcyAuaXRlbS1pbWFnZScpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgaW1nU3JjID0gJCgnaW1nJywgdGhpcykuYXR0cignc3JjJyk7XHJcbiAgICAgICAgICAgIGlmIChpbWdTcmMpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJywgJ3VybChcIicgKyBpbWdTcmMgKyAnXCIpJyk7XHJcbiAgICAgICAgICAgICAgICAkKCdpbWcnLCB0aGlzKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKHdpbmRvdykubG9hZChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICQoXCIuc2Nyb2xsYmFyXCIpLm1DdXN0b21TY3JvbGxiYXIoe1xyXG4gICAgICAgICAgICAgICAgYXhpczpcInh5XCIsXHJcbiAgICAgICAgICAgICAgICB0aGVtZTogXCJpbnNldC0yLWRhcmtcIlxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCgnLml0ZW1zIC5pdGVtLWZyYW1lJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGltYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAkKHRoaXMpLmRhdGEoJ3VybCcpLFxyXG4gICAgICAgICAgICAgICAgdGV4dFdpZHRoOiAkKHRoaXMpLmRhdGEoJ3RleHQtd2lkdGgnKSxcclxuICAgICAgICAgICAgICAgIHRleHRIZWlnaHQ6ICQodGhpcykuZGF0YSgndGV4dC1oZWlnaHQnKSxcclxuICAgICAgICAgICAgICAgIHRvcDogJCh0aGlzKS5kYXRhKCd0b3AnKSxcclxuICAgICAgICAgICAgICAgIGxlZnQ6ICQodGhpcykuZGF0YSgnbGVmdCcpLFxyXG4gICAgICAgICAgICAgICAgcm90YXRlOiAkKHRoaXMpLmRhdGEoJ3JvdGF0ZScpXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnaW1hZ2UnLCBKU09OLnN0cmluZ2lmeShpbWFnZSkpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gXCIvZWRpdC5odG1sXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0UGFnZUV2ZW50cygpIHtcclxuICAgICAgICBsZXQgdGltZU91dElkID0gbnVsbDtcclxuXHJcbiAgICAgICAgbGV0IHByZXZpZXdVcGRhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aW1lT3V0SWQpXHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZU91dElkKTtcclxuXHJcbiAgICAgICAgICAgIHRpbWVPdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaHRtbDJjYW52YXMoJChcIiNwcmV2aWV3XCIpLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25yZW5kZXJlZDogZnVuY3Rpb24oY2FudmFzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbWluaS1yZXN1bHQgLml0ZW0taW1hZ2UnKS5odG1sKGNhbnZhcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi50b1N0cmluZygpLmluZGV4T2YoJ2VkaXQuaHRtbCcpID4gLTEgJiYgIXNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2ltYWdlJykpIHtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gXCIvXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJChcImRpdlwiKS5pcyhcIiNwcmV2aWV3XCIpICYmIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2ltYWdlJykpIHtcclxuICAgICAgICAgICAgdmFyIGltYWdlID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdpbWFnZScpKTtcclxuICAgICAgICAgICAgdmFyIGltZ09iaiA9IG5ldyBJbWFnZUl0ZW0oaW1hZ2UudXJsLCBpbWFnZS50ZXh0V2lkdGgsIGltYWdlLnRleHRIZWlnaHQsIGltYWdlLnRvcCwgaW1hZ2UubGVmdCwgaW1hZ2Uucm90YXRlKTtcclxuICAgICAgICAgICAgdGhpcy5pbWFnZSA9IGltZ09iajtcclxuICAgICAgICAgICAgaW1nT2JqLmFwcGVuZFRvRG9tRWxlbWVudCgpO1xyXG5cclxuICAgICAgICAgICAgJCgnI2lucHV0LXRleHQnKS5vbihcImtleXVwXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoJyNtaW5pLXRleHQgLml0ZW0taW1hZ2UnKS5odG1sKCQodGhpcykuaHRtbCgpKTtcclxuICAgICAgICAgICAgICAgIGltZ09iai5zZXRUZXh0KCQodGhpcykuaHRtbCgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3VXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnI2lucHV0LXRleHQnKS5rZXlkb3duKGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRyYXAgdGhlIHJldHVybiBrZXkgYmVpbmcgcHJlc3NlZFxyXG4gICAgICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpbnNlcnQgMiBiciB0YWdzIChpZiBvbmx5IG9uZSBiciB0YWcgaXMgaW5zZXJ0ZWQgdGhlIGN1cnNvciB3b24ndCBnbyB0byB0aGUgbmV4dCBsaW5lKVxyXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRIVE1MJywgZmFsc2UsICc8YnI+PGJyPicpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgdGhlIGRlZmF1bHQgYmVoYXZpb3VyIG9mIHJldHVybiBrZXkgcHJlc3NlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcjaW5wdXQtdGV4dCwgI3ByLXRleHQnKS5jc3MoJ2ZvbnQtZmFtaWx5JywgJCgnI3NlbGVjdC1mb250JykudmFsKCkpO1xyXG4gICAgICAgICAgICAkKCcjc2VsZWN0LWZvbnQnKS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkKCcjaW5wdXQtdGV4dCwgI3ByLXRleHQnKS5jc3MoJ2ZvbnQtZmFtaWx5JywgJCh0aGlzKS52YWwoKSk7XHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3VXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnI2ZvbnQtc2l6ZScpLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoJyNpbnB1dC10ZXh0LCAjcHItdGV4dCcpLmNzcygnZm9udC1zaXplJywgJCh0aGlzKS52YWwoKSArICdweCcpO1xyXG4gICAgICAgICAgICAgICAgcHJldmlld1VwZGF0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBwaWNrZXIgPSBuZXcgQ1AoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQjZm9udC1jb2xvcicpKTtcclxuICAgICAgICAgICAgcGlja2VyLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKGNvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldC52YWx1ZSA9ICcjJyArIGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgJCgnI2lucHV0LXRleHQsICNwci10ZXh0JykuY3NzKCdjb2xvcicsICcjJyArIGNvbG9yKTtcclxuICAgICAgICAgICAgICAgIHByZXZpZXdVcGRhdGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcjbWluaS1yZXN1bHQnKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBodG1sMmNhbnZhcygkKFwiI3ByZXZpZXdcIiksIHtcclxuICAgICAgICAgICAgICAgICAgICBvbnJlbmRlcmVkOiBmdW5jdGlvbihjYW52YXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5wci1tb2RhbCAucHItYm9keScpLmh0bWwoY2FudmFzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnByLW1vZGFsJykuYWRkQ2xhc3MoJ3Nob3duJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnLnByLW1vZGFsJykuY2xpY2soZnVuY3Rpb24gKCl7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdzaG93bicpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZUltYWdlKCkge1xyXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoaXMuaW1hZ2UpIHtcclxuICAgICAgICAgICAgJCgnI2J0bi1kb3dubG9hZCcpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmltYWdlLnNhdmVJbWFnZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBsb2FkSW1hZ2UoKSB7XHJcbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAodGhpcy5pbWFnZSkge1xyXG4gICAgICAgICAgICAkKCcjYnRuLXBvc3RlcicpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmltYWdlLnVwbG9hZCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59IiwiJC5ub0NvbmZsaWN0KCk7XHJcbndpbmRvdy4kID0galF1ZXJ5O1xyXG5qUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgkKSB7XHJcbiAgICBuZXcgTWFpbigpO1xyXG5cclxuICAgIHdpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIEZCLmluaXQoe1xyXG4gICAgICAgICAgICBhcHBJZCAgICAgIDogJzEzMjgzNjE3NzM4OTU3MzYnLFxyXG4gICAgICAgICAgICBzdGF0dXM6IHRydWUsXHJcbiAgICAgICAgICAgIGNvb2tpZTogdHJ1ZSxcclxuICAgICAgICAgICAgeGZibWw6IHRydWUsXHJcbiAgICAgICAgICAgIGNoYW5uZWxVcmwgOiAnLy9kZW1vLnlvdXJzaXRlcy5vbmxpbmUnLFxyXG4gICAgICAgICAgICB2ZXJzaW9uICAgIDogJ3YyLjgnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIChmdW5jdGlvbihkLCBzLCBpZCl7XHJcbiAgICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xyXG4gICAgICAgIGlmIChkLmdldEVsZW1lbnRCeUlkKGlkKSkge3JldHVybjt9XHJcbiAgICAgICAganMgPSBkLmNyZWF0ZUVsZW1lbnQocyk7IGpzLmlkID0gaWQ7XHJcbiAgICAgICAganMuc3JjID0gXCIvL2Nvbm5lY3QuZmFjZWJvb2submV0L2VuX1VTL3Nkay5qc1wiO1xyXG4gICAgICAgIGZqcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgZmpzKTtcclxuICAgIH0oZG9jdW1lbnQsICdzY3JpcHQnLCAnZmFjZWJvb2stanNzZGsnKSk7XHJcbn0pOyJdfQ==
