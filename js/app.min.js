'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var ImageItem = function () {
    function ImageItem(url) {
        var textW = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100;
        var textH = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 100;
        var top = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
        var left = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
        var rotate = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
        var text = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : "";

        _classCallCheck(this, ImageItem);

        this.url = url;
        this.text = text;
        this.textW = textW;
        this.textH = textH;
        this.top = top;
        this.left = left;
        this.rotate = rotate;
    }

    _createClass(ImageItem, [{
        key: 'appendToDomElement',
        value: function appendToDomElement() {
            var html = '<div class="pr-body">' + '<img id="pr-image" src="' + this.url + '" />' + '<div id="pr-text">' + 'Integer semper ut libero vel aliquet. Cras vel ipsum sed nibh vestibulum lacinia. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Duis in quam dapibus, iaculis libero ac, vestibulum odio. Phasellus fermentum sapien at magna faucibus, ac convallis velit ultricies. Morbi eget enim vel elit cursus ultrices id quis nisl. Cras maximus facilisis venenatis.' + '</div>' + '</div>';
            $('#preview').html(html);

            $('#pr-text').css({
                'width': this.textW,
                'height': this.textH,
                'top': this.top,
                'left': this.left,
                '-webkit-transform': 'rotate(' + this.rotate + ')',
                '-moz-transform': 'rotate(' + this.rotate + ')',
                '-ms-transform': 'rotate(' + this.rotate + ')',
                '-o-transform': 'rotate(' + this.rotate + ')',
                'transform': 'rotate(' + this.rotate + ')'
            });

            $('#mini-image .item-image, #mini-result .item-image').css('background-image', 'url("' + this.url + '")');
        }
    }, {
        key: 'setText',
        value: function setText() {
            var text = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";

            this.text = text;
            $('#pr-text').html(this.text);
        }
    }, {
        key: 'getText',
        value: function getText() {
            return this.text;
        }
    }]);

    return ImageItem;
}();

var Main = function Main() {
    _classCallCheck(this, Main);
};

$.noConflict();
window.$ = jQuery;
jQuery(document).ready(function ($) {

    $('.item-image').each(function () {
        var imgSrc = $('img', this).attr('src');
        if (imgSrc) {
            $(this).css('background-image', 'url("' + imgSrc + '")');
            $('img', this).remove();
        }
    });

    $(window).load(function () {
        $('.items .item-frame').each(function (i) {
            var _this = this;
            setTimeout(function () {
                $(_this).addClass('animate');
            }, i * 50);
        });

        $(".scrollbar").mCustomScrollbar({
            axis: "xy",
            theme: "inset-2-dark"
        });
    });

    $('.items .item-frame').click(function (e) {
        e.preventDefault();

        var image = {
            url: $(this).data('url'),
            textWidth: $(this).data('text-width'),
            textHeight: $(this).data('text-height'),
            top: $(this).data('top'),
            left: $(this).data('left'),
            rotate: $(this).data('rotate')
        };

        try {
            sessionStorage.setItem('image', JSON.stringify(image));
            window.location = "/edit.html";
        } catch (ex) {
            console.log(ex);
        }
    });

    (function () {
        if (window.location.toString().indexOf('edit.html') > -1 && !sessionStorage.getItem('image')) {
            window.location = "/";
        }

        if ($("div").is("#preview") && sessionStorage.getItem('image')) {
            var image = JSON.parse(sessionStorage.getItem('image'));
            var imgObj = new ImageItem(image.url, image.textWidth, image.textHeight, image.top, image.left, image.rotate);
            imgObj.appendToDomElement();

            $('#input-text').on("keyup", function () {
                $('#mini-text .item-image').html($(this).html());
                imgObj.setText($(this).html());

                html2canvas($("#preview"), {
                    onrendered: function onrendered(canvas) {
                        document.body.appendChild(canvas);
                        $('#mini-result .item-image').html(canvas);
                    }
                });
            });
        }
    })();

    var link = document.createElement('a');
    link.innerHTML = 'download image';
    link.id = 'download';
    link.download = "mypainting.png";
    document.body.appendChild(link);

    $('.btn').on("click", function (e) {
        e.preventDefault();
        var _this = this;

        if (!$("div").is("#preview")) return;
        html2canvas($("#preview"), {
            onrendered: function onrendered(canvas) {
                document.body.appendChild(canvas);

                link.href = canvas.toDataURL();
                link.click();

                //var image = canvas.toDataURL('image/jpeg', 0.5);
                //var image = canvas.toDataURL('image/jpeg', 1.0).replace("image/jpeg", "image/octet-stream");  // here is the most important part because if you dont replace you will get a DOM 18 exception.
                //window.location.href = image; // it will save locally

                //$(_this).href(canvas.toDataURL('image/jpeg', 1.0));
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImltYWdlLmpzIiwibWFpbi5qcyIsImFwcC5qcyJdLCJuYW1lcyI6WyJJbWFnZUl0ZW0iLCJ1cmwiLCJ0ZXh0VyIsInRleHRIIiwidG9wIiwibGVmdCIsInJvdGF0ZSIsInRleHQiLCJodG1sIiwiJCIsImNzcyIsIk1haW4iLCJub0NvbmZsaWN0Iiwid2luZG93IiwialF1ZXJ5IiwiZG9jdW1lbnQiLCJyZWFkeSIsImVhY2giLCJpbWdTcmMiLCJhdHRyIiwicmVtb3ZlIiwibG9hZCIsImkiLCJfdGhpcyIsInNldFRpbWVvdXQiLCJhZGRDbGFzcyIsIm1DdXN0b21TY3JvbGxiYXIiLCJheGlzIiwidGhlbWUiLCJjbGljayIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImltYWdlIiwiZGF0YSIsInRleHRXaWR0aCIsInRleHRIZWlnaHQiLCJzZXNzaW9uU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwibG9jYXRpb24iLCJleCIsImNvbnNvbGUiLCJsb2ciLCJ0b1N0cmluZyIsImluZGV4T2YiLCJnZXRJdGVtIiwiaXMiLCJwYXJzZSIsImltZ09iaiIsImFwcGVuZFRvRG9tRWxlbWVudCIsIm9uIiwic2V0VGV4dCIsImh0bWwyY2FudmFzIiwib25yZW5kZXJlZCIsImNhbnZhcyIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImxpbmsiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiaWQiLCJkb3dubG9hZCIsImhyZWYiLCJ0b0RhdGFVUkwiXSwibWFwcGluZ3MiOiI7Ozs7OztJQUFBQSxTO0FBQ0EsdUJBQUFDLEdBQUEsRUFBQTtBQUFBLFlBQUFDLEtBQUEsdUVBQUEsR0FBQTtBQUFBLFlBQUFDLEtBQUEsdUVBQUEsR0FBQTtBQUFBLFlBQUFDLEdBQUEsdUVBQUEsQ0FBQTtBQUFBLFlBQUFDLElBQUEsdUVBQUEsQ0FBQTtBQUFBLFlBQUFDLE1BQUEsdUVBQUEsQ0FBQTtBQUFBLFlBQUFDLElBQUEsdUVBQUEsRUFBQTs7QUFBQTs7QUFDQSxhQUFB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QUFBLENBQUEzQyxFQUFBLElBQUEsRUFBQUQsSUFBQSxFQUFBOztBQUVBNkMsNEJBQUE1QyxFQUFBLFVBQUEsQ0FBQSxFQUFBO0FBQ0E2QyxnQ0FBQSxvQkFBQUMsTUFBQSxFQUFBO0FBQ0F4QyxpQ0FBQXlDLElBQUEsQ0FBQUMsV0FBQSxDQUFBRixNQUFBO0FBQ0E5QywwQkFBQSwwQkFBQSxFQUFBRCxJQUFBLENBQUErQyxNQUFBO0FBQ0E7QUFKQSxpQkFBQTtBQU1BLGFBVkE7QUFXQTtBQUNBLEtBdEJBOztBQTBCQSxRQUFBRyxPQUFBM0MsU0FBQTRDLGFBQUEsQ0FBQSxHQUFBLENBQUE7QUFDQUQsU0FBQUUsU0FBQSxHQUFBLGdCQUFBO0FBQ0FGLFNBQUFHLEVBQUEsR0FBQSxVQUFBO0FBQ0FILFNBQUFJLFFBQUEsR0FBQSxnQkFBQTtBQUNBL0MsYUFBQXlDLElBQUEsQ0FBQUMsV0FBQSxDQUFBQyxJQUFBOztBQUVBakQsTUFBQSxNQUFBLEVBQUEwQyxFQUFBLENBQUEsT0FBQSxFQUFBLFVBQUFyQixDQUFBLEVBQUE7QUFDQUEsVUFBQUMsY0FBQTtBQUNBLFlBQUFSLFFBQUEsSUFBQTs7QUFFQSxZQUFBLENBQUFkLEVBQUEsS0FBQSxFQUFBc0MsRUFBQSxDQUFBLFVBQUEsQ0FBQSxFQUNBO0FBQ0FNLG9CQUFBNUMsRUFBQSxVQUFBLENBQUEsRUFBQTtBQUNBNkMsd0JBQUEsb0JBQUFDLE1BQUEsRUFBQTtBQUNBeEMseUJBQUF5QyxJQUFBLENBQUFDLFdBQUEsQ0FBQUYsTUFBQTs7QUFFQUcscUJBQUFLLElBQUEsR0FBQVIsT0FBQVMsU0FBQSxFQUFBO0FBQ0FOLHFCQUFBN0IsS0FBQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQVpBLFNBQUE7QUFjQSxLQXBCQTtBQXNCQSxDQXRHQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgSW1hZ2VJdGVtIHtcclxuICAgIGNvbnN0cnVjdG9yKHVybCwgdGV4dFcgPSAxMDAsIHRleHRIID0gMTAwLCB0b3AgPSAwLCBsZWZ0ID0gMCwgcm90YXRlID0gMCwgdGV4dCA9IFwiXCIpIHtcclxuICAgICAgICB0aGlzLnVybCA9IHVybDtcclxuICAgICAgICB0aGlzLnRleHQgPSB0ZXh0O1xyXG4gICAgICAgIHRoaXMudGV4dFcgPSB0ZXh0VztcclxuICAgICAgICB0aGlzLnRleHRIID0gdGV4dEg7XHJcbiAgICAgICAgdGhpcy50b3AgPSB0b3A7XHJcbiAgICAgICAgdGhpcy5sZWZ0ID0gbGVmdDtcclxuICAgICAgICB0aGlzLnJvdGF0ZSA9IHJvdGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBhcHBlbmRUb0RvbUVsZW1lbnQoKSB7XHJcbiAgICAgICAgdmFyIGh0bWwgPSAnPGRpdiBjbGFzcz1cInByLWJvZHlcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGltZyBpZD1cInByLWltYWdlXCIgc3JjPVwiJysgdGhpcy51cmwgKydcIiAvPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGlkPVwicHItdGV4dFwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICdJbnRlZ2VyIHNlbXBlciB1dCBsaWJlcm8gdmVsIGFsaXF1ZXQuIENyYXMgdmVsIGlwc3VtIHNlZCBuaWJoIHZlc3RpYnVsdW0gbGFjaW5pYS4gUGVsbGVudGVzcXVlIGhhYml0YW50IG1vcmJpIHRyaXN0aXF1ZSBzZW5lY3R1cyBldCBuZXR1cyBldCBtYWxlc3VhZGEgZmFtZXMgYWMgdHVycGlzIGVnZXN0YXMuIER1aXMgaW4gcXVhbSBkYXBpYnVzLCBpYWN1bGlzIGxpYmVybyBhYywgdmVzdGlidWx1bSBvZGlvLiBQaGFzZWxsdXMgZmVybWVudHVtIHNhcGllbiBhdCBtYWduYSBmYXVjaWJ1cywgYWMgY29udmFsbGlzIHZlbGl0IHVsdHJpY2llcy4gTW9yYmkgZWdldCBlbmltIHZlbCBlbGl0IGN1cnN1cyB1bHRyaWNlcyBpZCBxdWlzIG5pc2wuIENyYXMgbWF4aW11cyBmYWNpbGlzaXMgdmVuZW5hdGlzLicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JztcclxuICAgICAgICAkKCcjcHJldmlldycpLmh0bWwoaHRtbCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgJCgnI3ByLXRleHQnKS5jc3Moe1xyXG4gICAgICAgICAgICAnd2lkdGgnOiB0aGlzLnRleHRXLFxyXG4gICAgICAgICAgICAnaGVpZ2h0JzogdGhpcy50ZXh0SCxcclxuICAgICAgICAgICAgJ3RvcCc6IHRoaXMudG9wLFxyXG4gICAgICAgICAgICAnbGVmdCc6IHRoaXMubGVmdCxcclxuICAgICAgICAgICAgJy13ZWJraXQtdHJhbnNmb3JtJzogJ3JvdGF0ZSgnICsgdGhpcy5yb3RhdGUgKyAnKScsXHJcbiAgICAgICAgICAgICctbW96LXRyYW5zZm9ybSc6ICdyb3RhdGUoJyArIHRoaXMucm90YXRlICsgJyknLFxyXG4gICAgICAgICAgICAnLW1zLXRyYW5zZm9ybSc6ICdyb3RhdGUoJyArIHRoaXMucm90YXRlICsgJyknLFxyXG4gICAgICAgICAgICAnLW8tdHJhbnNmb3JtJzogJ3JvdGF0ZSgnICsgdGhpcy5yb3RhdGUgKyAnKScsXHJcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAncm90YXRlKCcgKyB0aGlzLnJvdGF0ZSArICcpJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKCcjbWluaS1pbWFnZSAuaXRlbS1pbWFnZSwgI21pbmktcmVzdWx0IC5pdGVtLWltYWdlJykuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJywgJ3VybChcIicgKyB0aGlzLnVybCArICdcIiknKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRUZXh0KHRleHQgPSBcIlwiKSB7XHJcbiAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDtcclxuICAgICAgICAkKCcjcHItdGV4dCcpLmh0bWwodGhpcy50ZXh0KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRUZXh0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRleHQ7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBNYWluIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG59IiwiJC5ub0NvbmZsaWN0KCk7XHJcbndpbmRvdy4kID0galF1ZXJ5O1xyXG5qUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgkKSB7XHJcblxyXG4gICAgJCgnLml0ZW0taW1hZ2UnKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaW1nU3JjID0gJCgnaW1nJywgdGhpcykuYXR0cignc3JjJyk7XHJcbiAgICAgICAgaWYgKGltZ1NyYykge1xyXG4gICAgICAgICAgICAkKHRoaXMpLmNzcygnYmFja2dyb3VuZC1pbWFnZScsICd1cmwoXCInICsgaW1nU3JjICsgJ1wiKScpO1xyXG4gICAgICAgICAgICAkKCdpbWcnLCB0aGlzKS5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKHdpbmRvdykubG9hZChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJCgnLml0ZW1zIC5pdGVtLWZyYW1lJykuZWFjaChmdW5jdGlvbiAoaSkge1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoX3RoaXMpLmFkZENsYXNzKCdhbmltYXRlJyk7XHJcbiAgICAgICAgICAgIH0sIGkgKiA1MCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAkKFwiLnNjcm9sbGJhclwiKS5tQ3VzdG9tU2Nyb2xsYmFyKHtcclxuICAgICAgICAgICAgYXhpczpcInh5XCIsXHJcbiAgICAgICAgICAgIHRoZW1lOiBcImluc2V0LTItZGFya1wiXHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgJCgnLml0ZW1zIC5pdGVtLWZyYW1lJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgIHZhciBpbWFnZSA9IHtcclxuICAgICAgICAgICAgdXJsOiAkKHRoaXMpLmRhdGEoJ3VybCcpLFxyXG4gICAgICAgICAgICB0ZXh0V2lkdGg6ICQodGhpcykuZGF0YSgndGV4dC13aWR0aCcpLFxyXG4gICAgICAgICAgICB0ZXh0SGVpZ2h0OiAkKHRoaXMpLmRhdGEoJ3RleHQtaGVpZ2h0JyksXHJcbiAgICAgICAgICAgIHRvcDogJCh0aGlzKS5kYXRhKCd0b3AnKSxcclxuICAgICAgICAgICAgbGVmdDogJCh0aGlzKS5kYXRhKCdsZWZ0JyksXHJcbiAgICAgICAgICAgIHJvdGF0ZTogJCh0aGlzKS5kYXRhKCdyb3RhdGUnKVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2ltYWdlJywgSlNPTi5zdHJpbmdpZnkoaW1hZ2UpKTtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gXCIvZWRpdC5odG1sXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhleCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi50b1N0cmluZygpLmluZGV4T2YoJ2VkaXQuaHRtbCcpID4gLTEgJiYgIXNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2ltYWdlJykpIHtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gXCIvXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJChcImRpdlwiKS5pcyhcIiNwcmV2aWV3XCIpICYmIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2ltYWdlJykpIHtcclxuICAgICAgICAgICAgdmFyIGltYWdlID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdpbWFnZScpKTtcclxuICAgICAgICAgICAgdmFyIGltZ09iaiA9IG5ldyBJbWFnZUl0ZW0oaW1hZ2UudXJsLCBpbWFnZS50ZXh0V2lkdGgsIGltYWdlLnRleHRIZWlnaHQsIGltYWdlLnRvcCwgaW1hZ2UubGVmdCwgaW1hZ2Uucm90YXRlKTtcclxuICAgICAgICAgICAgaW1nT2JqLmFwcGVuZFRvRG9tRWxlbWVudCgpO1xyXG5cclxuICAgICAgICAgICAgJCgnI2lucHV0LXRleHQnKS5vbihcImtleXVwXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoJyNtaW5pLXRleHQgLml0ZW0taW1hZ2UnKS5odG1sKCQodGhpcykuaHRtbCgpKTtcclxuICAgICAgICAgICAgICAgIGltZ09iai5zZXRUZXh0KCQodGhpcykuaHRtbCgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBodG1sMmNhbnZhcygkKFwiI3ByZXZpZXdcIiksIHtcclxuICAgICAgICAgICAgICAgICAgICBvbnJlbmRlcmVkOiBmdW5jdGlvbihjYW52YXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbWluaS1yZXN1bHQgLml0ZW0taW1hZ2UnKS5odG1sKGNhbnZhcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pKCk7XHJcblxyXG5cclxuXHJcbiAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgIGxpbmsuaW5uZXJIVE1MID0gJ2Rvd25sb2FkIGltYWdlJztcclxuICAgIGxpbmsuaWQgPSAnZG93bmxvYWQnO1xyXG4gICAgbGluay5kb3dubG9hZCA9IFwibXlwYWludGluZy5wbmdcIjtcclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7XHJcblxyXG4gICAgJCgnLmJ0bicpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuXHJcbiAgICAgICAgaWYgKCEkKFwiZGl2XCIpLmlzKFwiI3ByZXZpZXdcIikpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICBodG1sMmNhbnZhcygkKFwiI3ByZXZpZXdcIiksIHtcclxuICAgICAgICAgICAgb25yZW5kZXJlZDogZnVuY3Rpb24oY2FudmFzKSB7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGluay5ocmVmID0gY2FudmFzLnRvRGF0YVVSTCgpO1xyXG4gICAgICAgICAgICAgICAgbGluay5jbGljaygpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vdmFyIGltYWdlID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvanBlZycsIDAuNSk7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBpbWFnZSA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL2pwZWcnLCAxLjApLnJlcGxhY2UoXCJpbWFnZS9qcGVnXCIsIFwiaW1hZ2Uvb2N0ZXQtc3RyZWFtXCIpOyAgLy8gaGVyZSBpcyB0aGUgbW9zdCBpbXBvcnRhbnQgcGFydCBiZWNhdXNlIGlmIHlvdSBkb250IHJlcGxhY2UgeW91IHdpbGwgZ2V0IGEgRE9NIDE4IGV4Y2VwdGlvbi5cclxuICAgICAgICAgICAgICAgIC8vd2luZG93LmxvY2F0aW9uLmhyZWYgPSBpbWFnZTsgLy8gaXQgd2lsbCBzYXZlIGxvY2FsbHlcclxuXHJcbiAgICAgICAgICAgICAgICAvLyQoX3RoaXMpLmhyZWYoY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvanBlZycsIDEuMCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbn0pOyJdfQ==
